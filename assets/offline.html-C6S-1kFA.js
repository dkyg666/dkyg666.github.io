import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as n,e,o}from"./app-dX96qGh5.js";const p={};function r(t,s){return o(),n("div",null,s[0]||(s[0]=[e(`<h1 id="离线部署docker" tabindex="-1"><a class="header-anchor" href="#离线部署docker"><span>离线部署Docker</span></a></h1><p>[TOC]</p><p>生产环境中一般都是没有公网资源的，本文介绍如何在生产服务器上离线部署<code>Docker</code></p><p>括号内的字母表示该操作需要在哪些服务器上执行</p><h2 id="centos7-离线安装docker" tabindex="-1"><a class="header-anchor" href="#centos7-离线安装docker"><span>Centos7 离线安装Docker</span></a></h2><h3 id="yum本地文件安装-推荐" tabindex="-1"><a class="header-anchor" href="#yum本地文件安装-推荐"><span>YUM本地文件安装（推荐）</span></a></h3><p>推荐这种方式，是因为在生产环境种一般会选定某个指定的文档软件版本使用。</p><h4 id="查询可用的软件版本-a" tabindex="-1"><a class="header-anchor" href="#查询可用的软件版本-a"><span>查询可用的软件版本(A)</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment">#下载清华的镜像源文件</span>
<span class="token function">wget</span> <span class="token parameter variable">-O</span> /etc/yum.repos.d/docker-ce.repo https://download.docker.com/linux/centos/docker-ce.repo

<span class="token function">sudo</span> <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;s+download.docker.com+mirrors.tuna.tsinghua.edu.cn/docker-ce+&#39;</span> /etc/yum.repos.d/docker-ce.repo

yum update
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> yum list docker-ce --showduplicates<span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-r</span>

Loading mirror speeds from cached hostfile
Loaded plugins: fastestmirror
docker-ce.x86_64            <span class="token number">24.0</span>.4-1.el7                        docker-ce-stable
docker-ce.x86_64            <span class="token number">3</span>:19.03.7-3.el7                     docker-ce-stable
docker-ce.x86_64            <span class="token number">3</span>:19.03.6-3.el7                     docker-ce-stable
docker-ce.x86_64            <span class="token number">3</span>:19.03.5-3.el7                     docker-ce-stable
docker-ce.x86_64            <span class="token number">3</span>:19.03.4-3.el7                     docker-ce-stable
docker-ce.x86_64            <span class="token number">3</span>:19.03.3-3.el7                     docker-ce-stable
docker-ce.x86_64            <span class="token number">3</span>:19.03.2-3.el7                     docker-ce-stable
docker-ce.x86_64            <span class="token number">3</span>:19.03.1-3.el7                     docker-ce-stable
<span class="token punctuation">..</span><span class="token punctuation">..</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="下载到指定文件夹-a" tabindex="-1"><a class="header-anchor" href="#下载到指定文件夹-a"><span>下载到指定文件夹(A)</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">--downloadonly</span> <span class="token parameter variable">--downloaddir</span><span class="token operator">=</span>/tmp/docker24_offline_install/ docker-ce-24.0.4-1.el7 docker-ce-cli-24.0.4-1.el7
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>Dependencies Resolved

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
 Package                                          Arch                                  Version                                         Repository                             Size
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Installing:
 docker-ce                                        x86_64                                <span class="token number">24.0</span>.4-1.el7                                 <span class="token function">docker</span>                                 <span class="token number">25</span> M
Installing <span class="token keyword">for</span> dependencies:
 container-selinux                                noarch                                <span class="token number">24.0</span>.4-1.el7                                   extras                                 <span class="token number">39</span> k
 containerd.io                                    x86_64                                <span class="token number">24.0</span>.4-1.el7                                  <span class="token function">docker</span>                                 <span class="token number">23</span> M
 docker-ce-cli                                    x86_64                                <span class="token number">24.0</span>.4-1.el7                                 <span class="token function">docker</span>                                 <span class="token number">40</span> M

Transaction Summary
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Install  <span class="token number">1</span> Package <span class="token punctuation">(</span>+3 Dependent packages<span class="token punctuation">)</span>

Total download size: <span class="token number">87</span> M
Installed size: <span class="token number">363</span> M
Background downloading packages, <span class="token keyword">then</span> exiting:
<span class="token punctuation">(</span><span class="token number">1</span>/4<span class="token punctuation">)</span>: container-selinux-24.0.4-1.el7.noarch.rpm                                                                                                              <span class="token operator">|</span>  <span class="token number">39</span> kB  00:00:00
<span class="token punctuation">(</span><span class="token number">2</span>/4<span class="token punctuation">)</span>: containerd.io-24.0.4-1.el7.x86_64.rpm                                                                                                               <span class="token operator">|</span>  <span class="token number">23</span> MB  00:00:00
<span class="token punctuation">(</span><span class="token number">3</span>/4<span class="token punctuation">)</span>: docker-ce-24.0.4-1.el7.x86_64.rpm                                                                                                                    <span class="token operator">|</span>  <span class="token number">25</span> MB  00:00:00
<span class="token punctuation">(</span><span class="token number">4</span>/4<span class="token punctuation">)</span>: docker-ce-cli-24.0.4-1.el7.x86_64.rpm                                                                                                                <span class="token operator">|</span>  <span class="token number">40</span> MB  00:00:00
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Total                                                                                                                                               <span class="token number">118</span> MB/s <span class="token operator">|</span>  <span class="token number">87</span> MB  00:00:00
exiting because <span class="token string">&quot;Download Only&quot;</span> specified
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="复制到目标服务器之后进入文件夹安装-c-n" tabindex="-1"><a class="header-anchor" href="#复制到目标服务器之后进入文件夹安装-c-n"><span>复制到目标服务器之后进入文件夹安装(C-N)</span></a></h4><ul><li>离线安装时，必须使用rpm命令不检查依赖的方式安装</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">rpm</span> <span class="token parameter variable">-Uvh</span> *.rpm <span class="token parameter variable">--nodeps</span> <span class="token parameter variable">--force</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="锁定软件版本-c-n" tabindex="-1"><a class="header-anchor" href="#锁定软件版本-c-n"><span>锁定软件版本(C-N)</span></a></h4><h5 id="下载锁定版本软件" tabindex="-1"><a class="header-anchor" href="#下载锁定版本软件"><span>下载锁定版本软件</span></a></h5><p>可参考下文的网络源搭建</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> yum <span class="token function">install</span> yum-plugin-versionlock
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="锁定软件版本" tabindex="-1"><a class="header-anchor" href="#锁定软件版本"><span>锁定软件版本</span></a></h5><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> yum versionlock <span class="token function">add</span> <span class="token function">docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="查看锁定列表" tabindex="-1"><a class="header-anchor" href="#查看锁定列表"><span>查看锁定列表</span></a></h5><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> yum versionlock list
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>Loaded plugins: fastestmirror, versionlock
<span class="token number">3</span>:docker-ce-24.0.4-1.el7.*
versionlock list <span class="token keyword">done</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="锁定后无法再更新" tabindex="-1"><a class="header-anchor" href="#锁定后无法再更新"><span>锁定后无法再更新</span></a></h5><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> yum <span class="token function">install</span> docker-ce
Loaded plugins: fastestmirror, versionlock
Loading mirror speeds from cached hostfile
Excluding <span class="token number">1</span> update due to versionlock <span class="token punctuation">(</span>use <span class="token string">&quot;yum versionlock status&quot;</span> to show it<span class="token punctuation">)</span>
Package <span class="token number">3</span>:docker-ce-24.0.4-1.el7.x86_64 already installed and latest version
Nothing to <span class="token keyword">do</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="解锁指定软件" tabindex="-1"><a class="header-anchor" href="#解锁指定软件"><span>解锁指定软件</span></a></h5><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> yum versionlock delete docker-ce
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>Loaded plugins: fastestmirror, versionlock
Deleting versionlock for: <span class="token number">3</span>:docker-ce-24.0.4-1.el7.*
versionlock deleted: <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="解锁所有软件" tabindex="-1"><a class="header-anchor" href="#解锁所有软件"><span>解锁所有软件</span></a></h5><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> yum versionlock delete all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="yum-本地源服务器搭建安装docker" tabindex="-1"><a class="header-anchor" href="#yum-本地源服务器搭建安装docker"><span>YUM 本地源服务器搭建安装Docker</span></a></h3><h4 id="挂载-iso-镜像搭建本地-file-源-ab" tabindex="-1"><a class="header-anchor" href="#挂载-iso-镜像搭建本地-file-源-ab"><span>挂载 ISO 镜像搭建本地 File 源（AB）</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 删除其他网络源</span>
<span class="token function">rm</span> <span class="token parameter variable">-f</span> /etc/yum.repo.d/*
<span class="token comment"># 挂载光盘或者iso镜像</span>
<span class="token function">mount</span> /dev/cdrom /mnt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 添加本地源</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span>/etc/yum.repos.d/local_files.repo<span class="token operator">&lt;&lt;</span> <span class="token string">EOF
[Local_Files]
name=Local_Files
baseurl=file:///mnt
enable=1
gpgcheck=0
gpgkey=file:///mnt/RPM-GPG-KEY-CentOS-7
EOF</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 测试刚才的本地源,安装createrepo软件</span>
yum clean all 
yum <span class="token function">install</span> createrepo <span class="token parameter variable">-y</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="根据本地文件搭建base网络源-b" tabindex="-1"><a class="header-anchor" href="#根据本地文件搭建base网络源-b"><span>根据本地文件搭建BASE网络源（B）</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 安装apache 服务器</span>
yum <span class="token function">install</span> httpd <span class="token parameter variable">-y</span>
<span class="token comment"># 挂载光盘</span>
<span class="token function">mount</span> /dev/cdrom /mnt
<span class="token comment"># 新建centos目录</span>
<span class="token function">mkdir</span> /var/www/html/base
<span class="token comment"># 复制光盘内的文件到刚才新建的目录</span>
<span class="token function">cp</span> <span class="token parameter variable">-R</span> /mnt/Packages/* /var/www/html/base/
createrepo  /var/www/html/centos/
systemctl <span class="token builtin class-name">enable</span> httpd
systemctl start httpd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="下载docker-ce-镜像仓库-a" tabindex="-1"><a class="header-anchor" href="#下载docker-ce-镜像仓库-a"><span>下载Docker-CE 镜像仓库（A）</span></a></h4><p>在有网络的服务器上下载Docker-ce镜像</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 下载清华的镜像源文件</span>
<span class="token function">wget</span> <span class="token parameter variable">-O</span> /etc/yum.repos.d/docker-ce.repo https://download.docker.com/linux/centos/docker-ce.repo
<span class="token function">sudo</span> <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;s+download.docker.com+mirrors.tuna.tsinghua.edu.cn/docker-ce+&#39;</span> /etc/yum.repos.d/docker-ce.repo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 新建 docker-ce目录</span>
<span class="token function">mkdir</span> /tmp/docker-ce/
<span class="token comment"># 把镜像源同步到镜像文件中</span>
reposync <span class="token parameter variable">-r</span> docker-ce-stable <span class="token parameter variable">-p</span> /tmp/docker-ce/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="创建仓库索引-b" tabindex="-1"><a class="header-anchor" href="#创建仓库索引-b"><span>创建仓库索引（B）</span></a></h4><p>把下载的 docker-ce 文件夹复制到离线的服务器</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 把docker-ce 文件夹复制到/var/www/html/docker-ce</span>
<span class="token comment"># 重建索引</span>
createrepo  /var/www/html/docker-ce/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="yum-客户端设置-c-n" tabindex="-1"><a class="header-anchor" href="#yum-客户端设置-c-n"><span>YUM 客户端设置（C...N）</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">rm</span> <span class="token parameter variable">-f</span> /etc/yum.repo.d/*
<span class="token function">cat</span> <span class="token operator">&gt;</span>/etc/yum.repos.d/local_files.repo<span class="token operator">&lt;&lt;</span> <span class="token string">EOF
[local_base]
name=local_base
# 改成B服务器地址
baseurl=http://x.x.x.x/base
enable=1
gpgcheck=0
proxy=_none_
[docker_ce]
name=docker_ce
# 改成B服务器地址
baseurl=http://x.x.x.x/base
enable=1
gpgcheck=0
proxy=_none_
EOF</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="docker-安装-c-n" tabindex="-1"><a class="header-anchor" href="#docker-安装-c-n"><span>Docker 安装（C...N）</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> yum makecache fast
<span class="token function">sudo</span> yum <span class="token function">install</span> docker-ce docker-ce-cli containerd.io
<span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,50)]))}const i=a(p,[["render",r],["__file","offline.html.vue"]]),d=JSON.parse(`{"path":"/index/Docker/install/offline.html","title":"离线部署Docker","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"Centos7 离线安装Docker","slug":"centos7-离线安装docker","link":"#centos7-离线安装docker","children":[{"level":3,"title":"YUM本地文件安装（推荐）","slug":"yum本地文件安装-推荐","link":"#yum本地文件安装-推荐","children":[{"level":4,"title":"查询可用的软件版本(A)","slug":"查询可用的软件版本-a","link":"#查询可用的软件版本-a","children":[]},{"level":4,"title":"下载到指定文件夹(A)","slug":"下载到指定文件夹-a","link":"#下载到指定文件夹-a","children":[]},{"level":4,"title":"复制到目标服务器之后进入文件夹安装(C-N)","slug":"复制到目标服务器之后进入文件夹安装-c-n","link":"#复制到目标服务器之后进入文件夹安装-c-n","children":[]},{"level":4,"title":"锁定软件版本(C-N)","slug":"锁定软件版本-c-n","link":"#锁定软件版本-c-n","children":[{"level":5,"title":"下载锁定版本软件","slug":"下载锁定版本软件","link":"#下载锁定版本软件","children":[]},{"level":5,"title":"锁定软件版本","slug":"锁定软件版本","link":"#锁定软件版本","children":[]},{"level":5,"title":"查看锁定列表","slug":"查看锁定列表","link":"#查看锁定列表","children":[]},{"level":5,"title":"锁定后无法再更新","slug":"锁定后无法再更新","link":"#锁定后无法再更新","children":[]},{"level":5,"title":"解锁指定软件","slug":"解锁指定软件","link":"#解锁指定软件","children":[]},{"level":5,"title":"解锁所有软件","slug":"解锁所有软件","link":"#解锁所有软件","children":[]}]}]},{"level":3,"title":"YUM 本地源服务器搭建安装Docker","slug":"yum-本地源服务器搭建安装docker","link":"#yum-本地源服务器搭建安装docker","children":[{"level":4,"title":"挂载 ISO 镜像搭建本地 File 源（AB）","slug":"挂载-iso-镜像搭建本地-file-源-ab","link":"#挂载-iso-镜像搭建本地-file-源-ab","children":[]},{"level":4,"title":"根据本地文件搭建BASE网络源（B）","slug":"根据本地文件搭建base网络源-b","link":"#根据本地文件搭建base网络源-b","children":[]},{"level":4,"title":"下载Docker-CE 镜像仓库（A）","slug":"下载docker-ce-镜像仓库-a","link":"#下载docker-ce-镜像仓库-a","children":[]},{"level":4,"title":"创建仓库索引（B）","slug":"创建仓库索引-b","link":"#创建仓库索引-b","children":[]},{"level":4,"title":"YUM 客户端设置（C...N）","slug":"yum-客户端设置-c-n","link":"#yum-客户端设置-c-n","children":[]},{"level":4,"title":"Docker 安装（C...N）","slug":"docker-安装-c-n","link":"#docker-安装-c-n","children":[]}]}]}],"git":{"createdTime":1731129855000,"updatedTime":1731129855000,"contributors":[{"name":"dkyg666","email":"43946866+dkyg666@users.noreply.github.com","commits":1}]},"readingTime":{"minutes":3.16,"words":947},"filePathRelative":"index/Docker/install/offline.md","localizedDate":"2024年11月9日","excerpt":"\\n<p>[TOC]</p>\\n<p>生产环境中一般都是没有公网资源的，本文介绍如何在生产服务器上离线部署<code>Docker</code></p>\\n<p>括号内的字母表示该操作需要在哪些服务器上执行</p>\\n<h2>Centos7 离线安装Docker</h2>\\n<h3>YUM本地文件安装（推荐）</h3>\\n<p>推荐这种方式，是因为在生产环境种一般会选定某个指定的文档软件版本使用。</p>\\n<h4>查询可用的软件版本(A)</h4>\\n<div class=\\"language-bash\\" data-ext=\\"sh\\" data-title=\\"sh\\"><pre class=\\"language-bash\\"><code><span class=\\"token comment\\">#下载清华的镜像源文件</span>\\n<span class=\\"token function\\">wget</span> <span class=\\"token parameter variable\\">-O</span> /etc/yum.repos.d/docker-ce.repo https://download.docker.com/linux/centos/docker-ce.repo\\n\\n<span class=\\"token function\\">sudo</span> <span class=\\"token function\\">sed</span> <span class=\\"token parameter variable\\">-i</span> <span class=\\"token string\\">'s+download.docker.com+mirrors.tuna.tsinghua.edu.cn/docker-ce+'</span> /etc/yum.repos.d/docker-ce.repo\\n\\nyum update\\n</code></pre></div>"}`);export{i as comp,d as data};
