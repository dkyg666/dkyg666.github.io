import{_ as d}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as t,e as o,b as s,d as n,a as r,o as i,r as l}from"./app-DYmmM49d.js";const c={},p={href:"https://github.com/tianon/gosu",target:"_blank",rel:"noopener noreferrer"};function u(m,e){const a=l("ExternalLinkIcon");return i(),t("div",null,[e[9]||(e[9]=o(`<h1 id="user-指定当前用户" tabindex="-1"><a class="header-anchor" href="#user-指定当前用户"><span>USER 指定当前用户</span></a></h1><p>格式：<code>USER &lt;用户名&gt;[:&lt;用户组&gt;]</code></p><p><code>USER</code> 指令和 <code>WORKDIR</code> 相似，都是改变环境状态并影响以后的层。<code>WORKDIR</code> 是改变工作目录，<code>USER</code> 则是改变之后层的执行 <code>RUN</code>, <code>CMD</code> 以及 <code>ENTRYPOINT</code> 这类命令的身份。</p><p>注意，<code>USER</code> 只是帮助你切换到指定用户而已，这个用户必须是事先建立好的，否则无法切换。</p><div class="language-docker line-numbers-mode" data-ext="docker" data-title="docker"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">RUN</span> groupadd -r redis &amp;&amp; useradd -r -g redis redis</span>
<span class="token instruction"><span class="token keyword">USER</span> redis</span>
<span class="token instruction"><span class="token keyword">RUN</span> [ <span class="token string">&quot;redis-server&quot;</span> ]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5)),s("p",null,[e[1]||(e[1]=n("如果以 ")),e[2]||(e[2]=s("code",null,"root",-1)),e[3]||(e[3]=n(" 执行的脚本，在执行期间希望改变身份，比如希望以某个已经建立好的用户来运行某个服务进程，不要使用 ")),e[4]||(e[4]=s("code",null,"su",-1)),e[5]||(e[5]=n(" 或者 ")),e[6]||(e[6]=s("code",null,"sudo",-1)),e[7]||(e[7]=n("，这些都需要比较麻烦的配置，而且在 TTY 缺失的环境下经常出错。建议使用 ")),s("a",p,[e[0]||(e[0]=s("code",null,"gosu",-1)),r(a)]),e[8]||(e[8]=n("。"))]),e[10]||(e[10]=o(`<div class="language-docker line-numbers-mode" data-ext="docker" data-title="docker"><pre class="language-docker"><code><span class="token comment"># 建立 redis 用户，并使用 gosu 换另一个用户执行命令</span>
<span class="token instruction"><span class="token keyword">RUN</span> groupadd -r redis &amp;&amp; useradd -r -g redis redis</span>
<span class="token comment"># 下载 gosu</span>
<span class="token instruction"><span class="token keyword">RUN</span> wget -O /usr/local/bin/gosu <span class="token string">&quot;https://github.com/tianon/gosu/releases/download/1.12/gosu-amd64&quot;</span> <span class="token operator">\\</span>
    &amp;&amp; chmod +x /usr/local/bin/gosu <span class="token operator">\\</span>
    &amp;&amp; gosu nobody true</span>
<span class="token comment"># 设置 CMD，并以另外的用户执行</span>
<span class="token instruction"><span class="token keyword">CMD</span> [ <span class="token string">&quot;exec&quot;</span>, <span class="token string">&quot;gosu&quot;</span>, <span class="token string">&quot;redis&quot;</span>, <span class="token string">&quot;redis-server&quot;</span> ]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1))])}const v=d(c,[["render",u],["__file","user.html.vue"]]),R=JSON.parse('{"path":"/index/Docker/image/dockerfile/user.html","title":"USER 指定当前用户","lang":"zh-CN","frontmatter":{},"headers":[],"git":{"createdTime":1731129855000,"updatedTime":1731129855000,"contributors":[{"name":"dkyg666","email":"43946866+dkyg666@users.noreply.github.com","commits":1}]},"readingTime":{"minutes":0.89,"words":268},"filePathRelative":"index/Docker/image/dockerfile/user.md","localizedDate":"2024年11月9日","excerpt":"\\n<p>格式：<code>USER &lt;用户名&gt;[:&lt;用户组&gt;]</code></p>\\n<p><code>USER</code> 指令和 <code>WORKDIR</code> 相似，都是改变环境状态并影响以后的层。<code>WORKDIR</code> 是改变工作目录，<code>USER</code> 则是改变之后层的执行 <code>RUN</code>, <code>CMD</code> 以及 <code>ENTRYPOINT</code> 这类命令的身份。</p>\\n<p>注意，<code>USER</code> 只是帮助你切换到指定用户而已，这个用户必须是事先建立好的，否则无法切换。</p>"}');export{v as comp,R as data};
