import{_ as t}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as r,e as l,b as e,d as s,a as i,o as d,r as o}from"./app-BAGG9h-A.js";const p={},c={href:"https://so.csdn.net/so/search?q=%E5%AE%89%E8%A3%85yum&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"},v={href:"https://blog.csdn.net/Lichen0196/article/details/137355517",target:"_blank",rel:"noopener noreferrer"},u={id:"获取密码",tabindex:"-1"},m={class:"header-anchor",href:"#获取密码"},b={href:"https://alist.nn.ci/zh/guide/install/script.html#%E8%8E%B7%E5%8F%96%E5%AF%86%E7%A0%81",target:"_blank",rel:"noopener noreferrer"},g={id:"低于v3-25-0版本",tabindex:"-1"},k={class:"header-anchor",href:"#低于v3-25-0版本"},h={href:"https://alist.nn.ci/zh/guide/install/script.html#%E4%BD%8E%E4%BA%8Ev3-25-0%E7%89%88%E6%9C%AC",target:"_blank",rel:"noopener noreferrer"},x={id:"高于v3-25-0版本",tabindex:"-1"},f={class:"header-anchor",href:"#高于v3-25-0版本"},E={href:"https://alist.nn.ci/zh/guide/install/script.html#%E9%AB%98%E4%BA%8Ev3-25-0%E7%89%88%E6%9C%AC",target:"_blank",rel:"noopener noreferrer"},y={href:"https://github.com/Xhofe/alist/releases",target:"_blank",rel:"noopener noreferrer"},A={href:"https://alist.nn.ci/zh/faq/why.html#lib64-libc-so-6-version-glibc-2-28-not-found-required-by-alist-%E6%88%96%E8%80%85-accept-function-not-implemented",target:"_blank",rel:"noopener noreferrer"},_={href:"https://alist.nn.ci/zh/guide/webdav.html",target:"_blank",rel:"noopener noreferrer"},T={id:"手动运行",tabindex:"-1"},P={class:"header-anchor",href:"#手动运行"},I={href:"https://alist.nn.ci/zh/guide/install/manual.html#%E6%89%8B%E5%8A%A8%E8%BF%90%E8%A1%8C",target:"_blank",rel:"noopener noreferrer"},R={id:"守护进程",tabindex:"-1"},w={class:"header-anchor",href:"#守护进程"},q={href:"https://alist.nn.ci/zh/guide/install/manual.html#%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B",target:"_blank",rel:"noopener noreferrer"},C={href:"https://www.bilibili.com/video/BV1rF41197Qv?t=187.0",target:"_blank",rel:"noopener noreferrer"},O={id:"如何更新",tabindex:"-1"},D={class:"header-anchor",href:"#如何更新"},S={href:"https://alist.nn.ci/zh/guide/install/manual.html#%E5%A6%82%E4%BD%95%E6%9B%B4%E6%96%B0",target:"_blank",rel:"noopener noreferrer"},B={id:"获取密码-1",tabindex:"-1"},U={class:"header-anchor",href:"#获取密码-1"},N={href:"https://alist.nn.ci/zh/guide/install/manual.html#%E8%8E%B7%E5%8F%96%E5%AF%86%E7%A0%81",target:"_blank",rel:"noopener noreferrer"},$={id:"低于v3-25-0版本-1",tabindex:"-1"},F={class:"header-anchor",href:"#低于v3-25-0版本-1"},j={href:"https://alist.nn.ci/zh/guide/install/manual.html#%E4%BD%8E%E4%BA%8Ev3-25-0%E7%89%88%E6%9C%AC",target:"_blank",rel:"noopener noreferrer"},z={id:"高于v3-25-0版本-1",tabindex:"-1"},L={class:"header-anchor",href:"#高于v3-25-0版本-1"},G={href:"https://alist.nn.ci/zh/guide/install/manual.html#%E9%AB%98%E4%BA%8Ev3-25-0%E7%89%88%E6%9C%AC",target:"_blank",rel:"noopener noreferrer"},M={id:"高于v3-25-0版本-2",tabindex:"-1"},X={class:"header-anchor",href:"#高于v3-25-0版本-2"},W={href:"https://alist.nn.ci/zh/guide/install/docker.html#%E9%AB%98%E4%BA%8Ev3-25-0%E7%89%88%E6%9C%AC",target:"_blank",rel:"noopener noreferrer"},H={id:"发行版本",tabindex:"-1"},V={class:"header-anchor",href:"#发行版本"},Y={href:"https://alist.nn.ci/zh/guide/install/docker.html#%E5%8F%91%E8%A1%8C%E7%89%88%E6%9C%AC",target:"_blank",rel:"noopener noreferrer"},K={id:"docker-cli",tabindex:"-1"},J={class:"header-anchor",href:"#docker-cli"},Q={href:"https://alist.nn.ci/zh/guide/install/docker.html#docker-cli",target:"_blank",rel:"noopener noreferrer"},Z={id:"docker-compose",tabindex:"-1"},nn={class:"header-anchor",href:"#docker-compose"},en={href:"https://alist.nn.ci/zh/guide/install/docker.html#docker-compose",target:"_blank",rel:"noopener noreferrer"},sn={id:"使用-aria2-离线下载",tabindex:"-1"},an={class:"header-anchor",href:"#使用-aria2-离线下载"},ln={href:"https://alist.nn.ci/zh/guide/install/docker.html#%E4%BD%BF%E7%94%A8-aria2-%E7%A6%BB%E7%BA%BF%E4%B8%8B%E8%BD%BD",target:"_blank",rel:"noopener noreferrer"},tn={href:"https://hub.docker.com/r/xhofe/alist-aria2",target:"_blank",rel:"noopener noreferrer"},rn={id:"开发版本",tabindex:"-1"},dn={class:"header-anchor",href:"#开发版本"},on={href:"https://alist.nn.ci/zh/guide/install/docker.html#%E5%BC%80%E5%8F%91%E7%89%88%E6%9C%AC",target:"_blank",rel:"noopener noreferrer"},pn={id:"docker-cli-1",tabindex:"-1"},cn={class:"header-anchor",href:"#docker-cli-1"},vn={href:"https://alist.nn.ci/zh/guide/install/docker.html#docker-cli-1",target:"_blank",rel:"noopener noreferrer"},un={id:"docker-compose-1",tabindex:"-1"},mn={class:"header-anchor",href:"#docker-compose-1"},bn={href:"https://alist.nn.ci/zh/guide/install/docker.html#docker-compose-1",target:"_blank",rel:"noopener noreferrer"},gn={id:"手动编译-docker-镜像",tabindex:"-1"},kn={class:"header-anchor",href:"#手动编译-docker-镜像"},hn={href:"https://alist.nn.ci/zh/guide/install/docker.html#%E6%89%8B%E5%8A%A8%E7%BC%96%E8%AF%91-docker-%E9%95%9C%E5%83%8F",target:"_blank",rel:"noopener noreferrer"},xn={id:"构建前端",tabindex:"-1"},fn={class:"header-anchor",href:"#构建前端"},En={href:"https://alist.nn.ci/zh/guide/install/source.html#%E6%9E%84%E5%BB%BA%E5%89%8D%E7%AB%AF",target:"_blank",rel:"noopener noreferrer"},yn={id:"构建后端",tabindex:"-1"},An={class:"header-anchor",href:"#构建后端"},_n={href:"https://alist.nn.ci/zh/guide/install/source.html#%E6%9E%84%E5%BB%BA%E5%90%8E%E7%AB%AF",target:"_blank",rel:"noopener noreferrer"},Tn={href:"https://github.com/alist-org/alist",target:"_blank",rel:"noopener noreferrer"},Pn={href:"https://nn.ci/alist",target:"_blank",rel:"noopener noreferrer"},In={href:"https://alist.nn.ci/zh/config/configuration.html#site_url",target:"_blank",rel:"noopener noreferrer"},Rn={id:"自动渐变背景",tabindex:"-1"},wn={class:"header-anchor",href:"#自动渐变背景"},qn={href:"https://alist-doc.nn.ci/docs/style#%E8%87%AA%E5%8A%A8%E6%B8%90%E5%8F%98%E8%83%8C%E6%99%AF",target:"_blank",rel:"noopener noreferrer"},Cn={href:"https://nginx.org/en/download.html",target:"_blank",rel:"noopener noreferrer"},On={href:"https://www.bilibili.com/read/cv9304632/",target:"_blank",rel:"noopener noreferrer"},Dn={href:"https://wangchujiang.com/linux-command/c/iptables.html#%E8%AF%AD%E6%B3%95",target:"_blank",rel:"noopener noreferrer"},Sn={href:"https://wangchujiang.com/linux-command/c/iptables.html#%E9%80%89%E9%A1%B9",target:"_blank",rel:"noopener noreferrer"},Bn={href:"https://wangchujiang.com/linux-command/c/iptables.html#%E5%91%BD%E4%BB%A4%E9%80%89%E9%A1%B9%E8%BE%93%E5%85%A5%E9%A1%BA%E5%BA%8F",target:"_blank",rel:"noopener noreferrer"},Un={href:"https://wangchujiang.com/linux-command/c/iptables.html#%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6",target:"_blank",rel:"noopener noreferrer"},Nn={href:"https://wangchujiang.com/linux-command/c/iptables.html#%E9%98%B2%E7%81%AB%E5%A2%99%E7%9A%84%E7%AD%96%E7%95%A5",target:"_blank",rel:"noopener noreferrer"},$n={href:"https://wangchujiang.com/linux-command/c/iptables.html#%E9%98%B2%E7%81%AB%E5%A2%99%E7%9A%84%E7%AD%96%E7%95%A5-1",target:"_blank",rel:"noopener noreferrer"},Fn={href:"https://wangchujiang.com/linux-command/c/iptables.html#%E6%B8%85%E7%A9%BA%E5%BD%93%E5%89%8D%E7%9A%84%E6%89%80%E6%9C%89%E8%A7%84%E5%88%99%E5%92%8C%E8%AE%A1%E6%95%B0",target:"_blank",rel:"noopener noreferrer"},jn={href:"https://wangchujiang.com/linux-command/c/iptables.html#%E9%85%8D%E7%BD%AE%E5%85%81%E8%AE%B8ssh%E7%AB%AF%E5%8F%A3%E8%BF%9E%E6%8E%A5",target:"_blank",rel:"noopener noreferrer"},zn={href:"https://wangchujiang.com/linux-command/c/iptables.html#%E5%85%81%E8%AE%B8%E6%9C%AC%E5%9C%B0%E5%9B%9E%E7%8E%AF%E5%9C%B0%E5%9D%80%E5%8F%AF%E4%BB%A5%E6%AD%A3%E5%B8%B8%E4%BD%BF%E7%94%A8",target:"_blank",rel:"noopener noreferrer"},Ln={href:"https://wangchujiang.com/linux-command/c/iptables.html#%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E7%9A%84%E8%A7%84%E5%88%99",target:"_blank",rel:"noopener noreferrer"},Gn={href:"https://wangchujiang.com/linux-command/c/iptables.html#%E9%85%8D%E7%BD%AE%E7%99%BD%E5%90%8D%E5%8D%95",target:"_blank",rel:"noopener noreferrer"},Mn={href:"https://wangchujiang.com/linux-command/c/iptables.html#%E5%BC%80%E5%90%AF%E7%9B%B8%E5%BA%94%E7%9A%84%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%A3",target:"_blank",rel:"noopener noreferrer"},Xn={href:"https://wangchujiang.com/linux-command/c/iptables.html#%E4%BF%9D%E5%AD%98%E8%A7%84%E5%88%99%E5%88%B0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD",target:"_blank",rel:"noopener noreferrer"},Wn={href:"https://wangchujiang.com/linux-command/c/iptables.html#%E5%88%97%E5%87%BA%E5%B7%B2%E8%AE%BE%E7%BD%AE%E7%9A%84%E8%A7%84%E5%88%99",target:"_blank",rel:"noopener noreferrer"},Hn={href:"https://wangchujiang.com/linux-command/c/iptables.html#%E6%B8%85%E9%99%A4%E5%B7%B2%E6%9C%89%E8%A7%84%E5%88%99",target:"_blank",rel:"noopener noreferrer"},Vn={href:"https://wangchujiang.com/linux-command/c/iptables.html#%E5%88%A0%E9%99%A4%E5%B7%B2%E6%B7%BB%E5%8A%A0%E7%9A%84%E8%A7%84%E5%88%99",target:"_blank",rel:"noopener noreferrer"},Yn={href:"https://wangchujiang.com/linux-command/c/iptables.html#%E5%BC%80%E6%94%BE%E6%8C%87%E5%AE%9A%E7%9A%84%E7%AB%AF%E5%8F%A3",target:"_blank",rel:"noopener noreferrer"},Kn={href:"https://wangchujiang.com/linux-command/c/iptables.html#%E5%B1%8F%E8%94%BDip",target:"_blank",rel:"noopener noreferrer"},Jn={href:"https://wangchujiang.com/linux-command/c/iptables.html#%E6%8C%87%E5%AE%9A%E6%95%B0%E6%8D%AE%E5%8C%85%E5%87%BA%E5%8E%BB%E7%9A%84%E7%BD%91%E7%BB%9C%E6%8E%A5%E5%8F%A3",target:"_blank",rel:"noopener noreferrer"},Qn={href:"https://wangchujiang.com/linux-command/c/iptables.html#%E6%9F%A5%E7%9C%8B%E5%B7%B2%E6%B7%BB%E5%8A%A0%E7%9A%84%E8%A7%84%E5%88%99",target:"_blank",rel:"noopener noreferrer"},Zn={href:"https://wangchujiang.com/linux-command/c/iptables.html#%E5%90%AF%E5%8A%A8%E7%BD%91%E7%BB%9C%E8%BD%AC%E5%8F%91%E8%A7%84%E5%88%99",target:"_blank",rel:"noopener noreferrer"},ne={href:"https://wangchujiang.com/linux-command/c/iptables.html#%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84",target:"_blank",rel:"noopener noreferrer"},ee={href:"https://wangchujiang.com/linux-command/c/iptables.html#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8C%B9%E9%85%8D",target:"_blank",rel:"noopener noreferrer"},se={href:"https://wangchujiang.com/linux-command/c/iptables.html#%E9%98%BB%E6%AD%A2windows%E8%A0%95%E8%99%AB%E7%9A%84%E6%94%BB%E5%87%BB",target:"_blank",rel:"noopener noreferrer"},ae={href:"https://wangchujiang.com/linux-command/c/iptables.html#%E9%98%B2%E6%AD%A2syn%E6%B4%AA%E6%B0%B4%E6%94%BB%E5%87%BB",target:"_blank",rel:"noopener noreferrer"},ie={href:"http://www.imooc.com/learn/389",target:"_blank",rel:"noopener noreferrer"},le={href:"https://hub.docker.com/r/enwaiax/x-ui",target:"_blank",rel:"noopener noreferrer"},te={href:"https://github.com/Chasing66/x-ui/graphs/contributors",target:"_blank",rel:"noopener noreferrer"},re={href:"https://github.com/Chasing66/x-ui/network/members",target:"_blank",rel:"noopener noreferrer"},de={href:"https://github.com/Chasing66/x-ui/stargazers",target:"_blank",rel:"noopener noreferrer"},oe={href:"https://github.com/Chasing66/x-ui/issues",target:"_blank",rel:"noopener noreferrer"},pe={href:"https://github.com/Chasing66/x-ui/blob/main/LICENSE",target:"_blank",rel:"noopener noreferrer"},ce={href:"https://github.com/vaxilu/x-ui",target:"_blank",rel:"noopener noreferrer"},ve={href:"https://github.com/FranzKafkaYu/x-ui",target:"_blank",rel:"noopener noreferrer"},ue={href:"https://github.com/X-UI-Unofficial",target:"_blank",rel:"noopener noreferrer"},me={id:"使用-vaxilu-x-ui-版本的",tabindex:"-1"},be={class:"header-anchor",href:"#使用-vaxilu-x-ui-版本的"},ge={href:"https://github.com/vaxilu/x-ui",target:"_blank",rel:"noopener noreferrer"},ke={href:"https://github.com/FranzKafkaYu/x-ui",target:"_blank",rel:"noopener noreferrer"},he={href:"https://certbot.eff.org/",target:"_blank",rel:"noopener noreferrer"},xe={href:"https://github.com/aircross/3x-ui/blob/main/README.en.md",target:"_blank",rel:"noopener noreferrer"},fe={href:"https://github.com/aircross/3x-ui/blob/main/README.es_ES.md",target:"_blank",rel:"noopener noreferrer"},Ee={href:"https://github.com/aircross/3x-ui/blob/main/README.ru_RU.md",target:"_blank",rel:"noopener noreferrer"},ye={href:"https://github.com/aircross/3x-ui/releases",target:"_blank",rel:"noopener noreferrer"},Ae={href:"https://hub.docker.com/r/aircross/3x-ui",target:"_blank",rel:"noopener noreferrer"},_e={href:"https://hub.docker.com/r/aircross/3x-ui",target:"_blank",rel:"noopener noreferrer"},Te={href:"https://img.shields.io/docker/pulls/aircross/3x-ui.svg?style=flat-square",target:"_blank",rel:"noopener noreferrer"},Pe={href:"https://www.gnu.org/licenses/gpl-3.0.en.html",target:"_blank",rel:"noopener noreferrer"},Ie={href:"https://github.com/aircross/x-ui",target:"_blank",rel:"noopener noreferrer"},Re={href:"https://img.shields.io/docker/pulls/aircross/x-ui.svg?style=flat-square",target:"_blank",rel:"noopener noreferrer"},we={href:"https://vps.la/2024/07/01/%E5%92%8C%E8%B0%90%E4%B9%8B%E5%90%8E%E5%A6%82%E4%BD%95%E5%9C%A8%E5%9B%BD%E5%86%85%E5%AE%89%E8%A3%85docker%E5%8F%8A%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F%E4%BD%BF%E7%94%A8/",target:"_blank",rel:"noopener noreferrer"},qe={href:"https://bwg.bulianglin.com/",target:"_blank",rel:"noopener noreferrer"},Ce={href:"https://name.bulianglin.com/",target:"_blank",rel:"noopener noreferrer"},Oe={href:"https://www.hostbuf.com/t/988.html",target:"_blank",rel:"noopener noreferrer"};function De(Se,n){const a=o("ExternalLinkIcon");return d(),r("div",null,[n[228]||(n[228]=l(`<h1 id="其他" tabindex="-1"><a class="header-anchor" href="#其他"><span>其他</span></a></h1><h2 id="docker导出镜像" tabindex="-1"><a class="header-anchor" href="#docker导出镜像"><span>docker导出镜像</span></a></h2><details><summary>【查看详情】</summary><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>#!/bin/bash
# 设置导出镜像的目录
EXPORT_DIR=&quot;/mnt/alist/share/images&quot;
# 确保导出目录存在
mkdir -p &quot;$EXPORT_DIR&quot;
# 获取所有的镜像并导出
IMAGES=$(docker images xhofe/alist --format &#39;{{.Repository}}:{{.Tag}}&#39;)
# 遍历所有的镜像
for IMAGE in $IMAGES; do
    # 分割镜像仓库名和标签
    IFS=&quot;:&quot; read -r REPOSITORY TAG &lt;&lt;&lt; &quot;$IMAGE&quot;
    # 将仓库名中的斜杠替换为下划线
    SAFE_REPOSITORY=\${REPOSITORY//\\//_}
    # 构造导出文件的名称
    EXPORT_FILE=&quot;\${SAFE_REPOSITORY}_\${TAG}.tar&quot;
    EXPORT_PATH=&quot;$EXPORT_DIR/$EXPORT_FILE&quot;
    # 检查镜像是否存在，如果存在则导出
    if docker image inspect &quot;\${REPOSITORY}:\${TAG}&quot; &gt;/dev/null 2&gt;&amp;1; then
        docker save -o &quot;$EXPORT_PATH&quot; &quot;\${REPOSITORY}:\${TAG}&quot;
        echo &quot;Exported \${REPOSITORY}:\${TAG} to $EXPORT_PATH&quot;
        # 创建 MD5 文件，只显示 MD5 值和文件名
        md5sum &quot;$EXPORT_PATH&quot; | awk &#39;{print $1, &quot;&#39;$EXPORT_FILE&#39;&quot;}&#39; &gt; &quot;$EXPORT_PATH.md5&quot;
        echo &quot;MD5 checksum saved to $EXPORT_PATH.md5&quot;
        # 将镜像文件和 MD5 文件打包成 .tar.gz 压缩文件
        tar -czf &quot;\${EXPORT_PATH}.gz&quot; -C &quot;$EXPORT_DIR&quot; &quot;$EXPORT_FILE&quot; &quot;$EXPORT_FILE.md5&quot;
        echo &quot;Compressed \${EXPORT_FILE} and \${EXPORT_FILE}.md5 into \${EXPORT_PATH}.gz&quot;
          else
        echo &quot;Error: \${REPOSITORY}:\${TAG} does not exist&quot;
    fi
done
echo &quot;Export and compression process completed.&quot;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h2 id="git提交代码" tabindex="-1"><a class="header-anchor" href="#git提交代码"><span>Git提交代码</span></a></h2><details><summary>【查看详情】</summary><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>
git init                    初始化一个新仓库
git branch -m master main   将默认的主分支名称从“master”更改为“main”
git add -A                  将所有更改的文件添加到暂存区
git commit -m &#39;deploy&#39;      提交这些更改，并添加提交信息“deploy”。

# 如果发布到 https://&lt;USERNAME&gt;.github.io
# git push -f git@github.com:&lt;USERNAME&gt;/&lt;USERNAME&gt;.github.io.git main

# 如果发布到 https://&lt;USERNAME&gt;.github.io/&lt;REPO&gt;

git push -f git@github.com:ni&#39;de.git main


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h2 id="配置alist反向代理" tabindex="-1"><a class="header-anchor" href="#配置alist反向代理"><span>配置alist反向代理</span></a></h2><details><summary>【查看详情】</summary><p>我们进入nginx的配置文件夹</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>NGINX默认安装路径
/usr/sbin/nginx：主程序
/etc/nginx：存放配置文件
/usr/share/nginx：存放静态文件
/var/log/nginx：存放日志
/run/nginx.pid nginx pid路径

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>cd /etc/nginx/conf.d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>新建一个alist的反代配置文件</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>nano alist.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在文件中放入如下内容</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>server {
    listen 80;
    listen [::]:80;
    server_name example.com;  # 替换为你的域名

    # 强制重定向到 HTTPS
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl;
    listen [::]:443 ssl;
    server_name example.com;  # 替换为你的域名

    ssl_certificate /etc/nginx/keyfile/cert.pem;  
    ssl_certificate_key /etc/nginx/keyfile/key.pem;  

    # SSL 配置（可选）
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers &#39;ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384&#39;;
    ssl_prefer_server_ciphers on;

    location / {
               proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
               proxy_set_header X-Forwarded-Proto $scheme;
               proxy_set_header Host $http_host;
               proxy_set_header X-Real-IP $remote_addr;
               proxy_set_header Range $http_range;
               proxy_set_header If-Range $http_if_range;
               proxy_redirect off;
               proxy_pass http://127.0.0.1:5244;     #反代不同服务修改这里
               # the max size of file to upload
               client_max_body_size 20000m;
             }
}


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>同时我们关闭直接对公网ip和未配置域名的访问</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>nano close.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>放置如下内容</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>server {
    listen 80 default_server;
    listen [::]:80 default_server;
    server_name _;

    # 对未配置的域名返回 444
    return 444;
}

server {
    listen 443 ssl default_server;
    listen [::]:443 ssl default_server;
    server_name _;

    ssl_certificate /etc/nginx/keyfile/cert.pem;  
    ssl_certificate_key /etc/nginx/keyfile/key.pem;


    # 对未配置的域名返回 444
    return 444;
}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启nginx反代即生效</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>sudo systemctl restart nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>手动切割日志文件</p><p>默认 Nginx 的日志都是输出到一个文件中的，是不会按照日期进行切割的，这样会导致文件越来越大，不利于查看。</p><p>我们可以编写一个脚本文件，通过命令来进行切割。</p><p>例如命令为：cut_nginx_log.sh</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>#!/bin/bash
# 日志路径
LOG_PATH=&quot;/usr/local/nginx/logs&quot;

# 生成一个时间的字符串
RECORD_TIME=$(date -d &quot;yesterday&quot; +%Y-%m-%d-%H-%M-%S)

# nginx的PID
PID=/usr/local/nginx/logs/nginx.pid

# 移动文件
mv \${LOG_PATH}/access.log \${LOG_PATH}/access.\${RECORD_TIME}.log
mv \${LOG_PATH}/error.log \${LOG_PATH}/error.\${RECORD_TIME}.log

# 向Nginx主进程发送信号，用于重新打开日志文件
kill -USR1 \`cat $PID\`

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编写好了，赋予文件执行权限。然后执行脚本文件：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>sudo chmod +x cut_nginx_log.sh

./cut_nginx_log.sh

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h2 id="通过公钥进行ssh连接" tabindex="-1"><a class="header-anchor" href="#通过公钥进行ssh连接"><span>通过公钥进行ssh连接</span></a></h2><details><summary>【查看详情】</summary><p>这篇文章介绍了使用ssh公钥连接设备的方法</p><p>注意</p><p>注1、建议使用1.2法二在本地生成密钥。</p><h2 id="_1-生成密钥" tabindex="-1"><a class="header-anchor" href="#_1-生成密钥"><span>1 生成密钥</span></a></h2><h3 id="_1-1-法一-在设备生成密钥-不推荐" tabindex="-1"><a class="header-anchor" href="#_1-1-法一-在设备生成密钥-不推荐"><span>1.1 法一：在设备生成密钥[<strong>不推荐</strong>]</span></a></h3><p>我们先正常的ssh连接到设备，输入如下命令，然后一直回车，生成密钥。</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>ssh-keygen -m PEM -t rsa -b 4096 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后我们进入自己家目录下的<code>.ssh</code>文件夹。</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>cd .ssh 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果输入<code>ls</code>命令可以看到生成了两个文件，<code>id_rsa</code>和<code>id_rsa.pub</code>，<code>id_rsa.pub</code>就是我们的公钥文件，我们用如下命令将公钥保存在验证文件中。</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>cat id_rsa.pub &gt;&gt; authorized_keys 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后我们分别授予验证文件和.ssh文件夹对应的读写权限</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>chmod 600 authorized_keys 
chmod 700 ~/.ssh 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>然后我们将私钥文件<code>id_rsa</code>下载到本地，用我们的ssh工具导入私钥文件，进行连接尝试。</p><h3 id="_1-2-法二-在本地生成密钥" tabindex="-1"><a class="header-anchor" href="#_1-2-法二-在本地生成密钥"><span>1.2 法二：在本地生成密钥</span></a></h3><p>我们<code>Win+R</code>再打开的界面输入<code>cmd</code>回车，然后输入如下命令，一直回车生成密钥。</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>ssh-keygen -m PEM -t rsa -b 4096 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后我们正常ssh连接到设备，然后创建并进入.ssh文件夹</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>mkdir -p .ssh &amp;&amp; cd .ssh 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后创建<code>authorized_keys</code>验证文件</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>nano authorized_keys 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在c盘下的<code>用户</code>文件夹，<code>自己用户名</code>的文件夹，<code>.ssh</code>文件夹，将里面的<code>id_rsa.pub</code>文件右键打开方式，使用记事本打开，将全部内容复制到<code>authorized_keys</code>内，并保存退出。</p><p>然后我们分别授予验证文件和.ssh文件夹对应的读写权限</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>chmod 600 authorized_keys 
chmod 700 ~/.ssh 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>然后我们可以直接断开连接，然后ssh到设备查看是否需要密码，如已经不再需要密码直接连接，公钥即已经配置好了。</p><p>我们也可以在任意支持ssh连接的软件导入<code>.ssh</code>文件夹内的私钥文件<code>id_rsa</code>即可实现直接连接。</p><h2 id="_2-关闭ssh的账号密码登陆" tabindex="-1"><a class="header-anchor" href="#_2-关闭ssh的账号密码登陆"><span>2 关闭ssh的账号密码登陆</span></a></h2><p>我们尝试公钥连接成功后，我们关闭ssh的密码连接，我们打开ssh的配置文件</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>sudo nano /etc/ssh/sshd_config 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>我们找到<code>#PasswordAuthentication yes</code>这行，将其修改为</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>PasswordAuthentication no 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后保存退出，重启sshd配置生效</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>sudo service sshd restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></details><h2 id="docker" tabindex="-1"><a class="header-anchor" href="#docker"><span>Docker</span></a></h2>`,10)),e("details",null,[n[4]||(n[4]=e("summary",null,"【查看详情】",-1)),n[5]||(n[5]=s(" ### 安装docker ")),e("p",null,[n[1]||(n[1]=s("安装Docker需要将我们的计算机联网，")),e("a",c,[n[0]||(n[0]=s("安装yum")),i(a)]),n[2]||(n[2]=s("工具"))]),n[6]||(n[6]=l(`<div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>yum install -y yum-utils 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>更新本地镜像</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code># 设置docker镜像源
yum-config-manager \\
    --add-repo \\
    https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
    
yum makecache fast
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>直接使用<code>yum</code>命令即可安装 Docker。</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>yum install docker-ce docker-ce-cli containerd.io
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>yum install docker-ce-26.1.4 docker-ce-cli-26.1.4 containerd.io-1.6.33
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>安装指定版本的DockerEngine（可选）
列出仓库存在的版本信息：
<span class="token function">apt-cache</span> madison docker-ce

<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> docker-ce<span class="token operator">=</span><span class="token number">5</span>:26.1.4-1~ubuntu.22.04~jammy docker-ce-cli<span class="token operator">=</span><span class="token number">5</span>:26.1.4-1~ubuntu.22.04~jammy <span class="token assign-left variable">containerd.io</span><span class="token operator">=</span><span class="token number">1.6</span>.33-1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="启动docker" tabindex="-1"><a class="header-anchor" href="#启动docker"><span>启动Docker</span></a></h3><p>通过命令启动docker：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>systemctl start docker  # 启动服务
systemctl status docker  # 查看状态
systemctl stop docker  # 停止服务
systemctl restart docker  # 重启服务
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后输入命令，可以查看docker版本：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>docker -v
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>出现版本才算成功</p><p>为了让 Docker 在每次重启系统的时候能i自动运行，还需要设置自启动：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>systemctl enable docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code># 关闭
systemctl stop firewalld
# 禁止开机启动防火墙
systemctl disable firewalld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>卸载Docker</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code># 卸载docker
yum remove docker-ce docker-ce-cli containerd.io

# 删除docker docker默认工作路径
rm -rf /var/lib/docker

rm -rf /etc/docker
rm -rf /run/docker
rm -rf /var/lib/dockershim
rm -rf /var/lib/docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>卸载脚本</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>#!/bin/bash
systemctl stop docker
yum remove docker \\
                  docker-ce* \\
                  docker-buildx-plugin \\
                  docker-compose-plugin \\
                  docker-scan-plugin \\
                  containerd.io \\
                  container-selinux
rm -rf /var/lib/docker
rm -rf /etc/docker/daemon.json
rm -rf /etc/docker
rm -rf /run/docker
rm -rf /var/lib/dockershim
rm -rf /var/lib/docker
yum list installed | grep docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>docker exec -it 容器id /bin/bash
docker attach 
docker commit -m=&quot;描述信息&quot; -a=&quot;作者&quot; 容器ID 目标镜像名:[TAG]
docker save -o /路径/镜像名.tar 镜像名:[TAG]
docker load -i /路径/镜像名.tar

docker inspect 容器id

docker builder prune 清除构建缓存
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>卸载docker
1.删除docker的所有包
apt-get autoremove docker docker-ce docker-engine  docker.io  containerd runc
2.查看docker是否卸载干净
dpkg -l | grep docker

dpkg -l |grep ^rc|awk &#39;{print $2}&#39; |sudo xargs dpkg -P
3.删除相关插件
apt-get autoremove docker-ce-*
4.删除docker配置目录
rm -rf /etc/systemd/system/docker.service.d

rm -rf /var/lib/docker
5.确定docker卸载完毕
docker --version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="compose" tabindex="-1"><a class="header-anchor" href="#compose"><span>compose</span></a></h2><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>COMPOSE_VERSION=$(curl -s https://api.github.com/repos/docker/compose/releases/latest | grep &#39;tag_name&#39; | cut -d\\&quot; -f4)

sh -c &quot;curl -L https://github.com/docker/compose/releases/download/\${COMPOSE_VERSION}/docker-compose-\`uname -s\`-\`uname -m\` &gt; /usr/local/bin/docker-compose&quot;

sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.29.1/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose

sudo chmod +x /usr/local/bin/docker-compose

sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose



$ docker-compose --version
docker-compose version 1.29.1, build 1110ad01


rm  /usr/bin/docker-compose
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>将docker-compose赋予可执行权限
chmod +x /usr/local/bin/docker-compose
建立连接
ln -s /usr/local/bin/docker-compose docker-compose
确认是否安裝成功
docker-compose -v
卸载
sudo rm /usr/local/bin/docker-compose

mkdir 创建工作文件夹
touch docker-compose.yml
 启动服务
docker-compose up -d
停止服务
docker-compose down
列出所有运行容器
docker-compose ps
查看服务日志
docker-compose logs
构建或
docker-compose build者重新构建服务
启动服务
docker-compose start
停止已运行的服务
docker-compose stop
重启服务
docker-compose restart

 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>设置镜像仓库</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>vi /etc/docker/daemon.json

# 内容如下：
{
  &quot;registry-mirrors&quot;: [
    &quot;https://docker.m.daocloud.io&quot;
  ]
}

{
  &quot;registry-mirrors&quot;: [
    &quot;https://1996099.xyz&quot;
  ]
}

# 退出并保存
:wq

# 使配置生效
systemctl daemon-reload

# 重启Docker
systemctl restart docker

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="reference" tabindex="-1"><a class="header-anchor" href="#reference"><span>Reference</span></a></h1>`,28)),e("ul",null,[e("li",null,[e("a",v,[n[3]||(n[3]=s("docker国内镜像源配置及走代理设置_docker 镜像代理-CSDN博客")),i(a)])])]),n[7]||(n[7]=l(`<h1 id="说明" tabindex="-1"><a class="header-anchor" href="#说明"><span>说明</span></a></h1><ul><li><p>首先，自己要解决网络问题，这里省略一万字...</p></li><li><p>注意：配置了<code>daemon.json</code>的，去把里面的镜像源都先删掉，可以先备份一下。</p></li></ul><h1 id="命令" tabindex="-1"><a class="header-anchor" href="#命令"><span>命令</span></a></h1><ul><li>在docker的进程服务文件夹配置代理，如果没有我们就新建这个文件夹：</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">mkdir</span> /usr/lib/systemd/system/docker.service.d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>cd /usr/lib/systemd/system/docker.service.d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>然后在<code>docker.service.d</code>文件夹里新建我们的代理文件<code>proxy.conf</code></li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">vim</span> proxy.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>并把文件写如下面这个格式，我这里是本机的客户端，自己按自己的客户端写</li></ul><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>[Service]
Environment=&quot;HTTP_PROXY=http://192.168.18.144:7890/&quot;
Environment=&quot;HTTPS_PROXY=http://192.168.18.144:7890/&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>:wq</code>保存并退出<code>proxy.conf</code>文件，和更改镜像源一样，重启docker，并重启daemon进程。</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl daemon-reload
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl restart <span class="token function">docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>最后，验证一下是否修改成功，出现了代理信息表示成功。</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">docker</span> info
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="centos-7-x-修改固定ip地址" tabindex="-1"><a class="header-anchor" href="#centos-7-x-修改固定ip地址"><span>CentOS 7.x 修改固定IP地址</span></a></h4><p>进入centos7虚拟机窗口</p><p>输入：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>vi  /etc/sysconfig/network-scripts/ifcfg-ens33
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,19))]),n[229]||(n[229]=e("h2",{id:"alist",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#alist"},[e("span",null,"Alist")])],-1)),e("details",null,[n[87]||(n[87]=l(`<summary>【查看详情】</summary><h1 id="一键脚本" tabindex="-1"><a class="header-anchor" href="#一键脚本"><span>一键脚本</span></a></h1><p><strong>安装</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> <span class="token string">&quot;https://alist.nn.ci/v3.sh&quot;</span> <span class="token operator">|</span> <span class="token function">bash</span> <span class="token parameter variable">-s</span> <span class="token function">install</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>更新</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> <span class="token string">&quot;https://alist.nn.ci/v3.sh&quot;</span> <span class="token operator">|</span> <span class="token function">bash</span> <span class="token parameter variable">-s</span> update
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>卸载</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> <span class="token string">&quot;https://alist.nn.ci/v3.sh&quot;</span> <span class="token operator">|</span> <span class="token function">bash</span> <span class="token parameter variable">-s</span> uninstall
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="自定义路径" tabindex="-1"><a class="header-anchor" href="#自定义路径"><span><strong>自定义路径</strong></span></a></h2><p>默认安装在 <code>/opt/alist</code> 中。 自定义安装路径，将安装路径作为第二个参数添加，必须是绝对路径（如果路径以 alist 结尾，则直接安装到给定路径，否则会安装在给定路径 alist 目录下），如 安装到 <code>/root</code>：</p><p>正式版</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># Install</span>
<span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> <span class="token string">&quot;https://alist.nn.ci/v3.sh&quot;</span> <span class="token operator">|</span> <span class="token function">bash</span> <span class="token parameter variable">-s</span> <span class="token function">install</span> /root
<span class="token comment"># update</span>
<span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> <span class="token string">&quot;https://alist.nn.ci/v3.sh&quot;</span> <span class="token operator">|</span> <span class="token function">bash</span> <span class="token parameter variable">-s</span> update /root
<span class="token comment"># Uninstall</span>
<span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> <span class="token string">&quot;https://alist.nn.ci/v3.sh&quot;</span> <span class="token operator">|</span> <span class="token function">bash</span> <span class="token parameter variable">-s</span> uninstall /root
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>启动: <code>systemctl start alist</code></li><li>关闭: <code>systemctl stop alist</code></li><li>状态: <code>systemctl status alist</code></li><li>重启: <code>systemctl restart alist</code></li></ul>`,13)),e("h2",u,[e("a",m,[e("span",null,[e("a",b,[n[8]||(n[8]=s("#")),i(a)]),n[9]||(n[9]=e("strong",null,"获取密码",-1))])])]),n[88]||(n[88]=e("p",null,"需要进入脚本安装AList的目录文件夹內执行如下命令",-1)),e("h4",g,[e("a",k,[e("span",null,[e("a",h,[n[10]||(n[10]=s("#")),i(a)]),n[11]||(n[11]=s("低于v3.25.0版本"))])])]),n[89]||(n[89]=e("div",{class:"language-bash line-numbers-mode","data-ext":"sh","data-title":"sh"},[e("pre",{class:"language-bash"},[e("code",null,`./alist admin
`)]),e("div",{class:"line-numbers","aria-hidden":"true"},[e("div",{class:"line-number"})])],-1)),e("h4",x,[e("a",f,[e("span",null,[e("a",E,[n[12]||(n[12]=s("#")),i(a)]),n[13]||(n[13]=s("高于v3.25.0版本"))])])]),n[90]||(n[90]=l(`<p>3.25.0以上版本将密码改成加密方式存储的hash值，无法直接反算出密码，如果忘记了密码只能通过重新 <strong><code>随机生成</code></strong> 或者 <strong><code>手动设置</code></strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 随机生成一个密码</span>
./alist admin random
<span class="token comment"># 手动设置一个密码,\`NEW_PASSWORD\`是指你需要设置的密码</span>
./alist admin <span class="token builtin class-name">set</span> NEW_PASSWORD
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="手动安装" tabindex="-1"><a class="header-anchor" href="#手动安装"><span>手动安装</span></a></h1><h2 id="获取-alist" tabindex="-1"><a class="header-anchor" href="#获取-alist"><span><strong>获取 AList</strong></span></a></h2>`,4)),e("p",null,[n[15]||(n[15]=s("打开 ")),e("a",y,[n[14]||(n[14]=s("AList Releaseopen in new window")),i(a)]),n[16]||(n[16]=s(" 下载待部署系统对应的文件。最新版的前端已经和后端打包好了，不用再下载前端文件了。"))]),n[91]||(n[91]=e("p",null,"xxxx 指的是不同系统/架构对应的名称，一般 Linux-x86/64 为 alist-linux-amd64",-1)),e("p",null,[n[18]||(n[18]=s("手动安装如果有如下提示：是因为")),e("a",A,[n[17]||(n[17]=s("你的 GLIBC 版本太低")),i(a)]),n[19]||(n[19]=s("，建议下载 musl 版本"))]),n[92]||(n[92]=l(`<div class="language-txt line-numbers-mode" data-ext="txt" data-title="txt"><pre class="language-txt"><code>lib64/libc.so.6: version \`GLIBC_2.28&#39; not found (required by ./alist)  
#或者
accept: function not implemented
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1)),e("p",null,[n[21]||(n[21]=s("当你看到 ")),n[22]||(n[22]=e("code",null,"start server@0.0.0.0:5244",-1)),n[23]||(n[23]=s(" 的输出，之后没有报错，说明操作成功。 第一次运行时会输出初始密码。程序默认监听 5244 端口。 现在打开 ")),n[24]||(n[24]=e("code",null,"http://ip:5244",-1)),n[25]||(n[25]=s(" 可以看到登录页面，WebDAV 请参阅 ")),e("a",_,[n[20]||(n[20]=s("WebDav")),i(a)]),n[26]||(n[26]=s("。"))]),e("h2",T,[e("a",P,[e("span",null,[e("a",I,[n[27]||(n[27]=s("#")),i(a)]),n[28]||(n[28]=e("strong",null,"手动运行",-1))])])]),n[93]||(n[93]=l(`<p>v3.25.0以上版本将密码改成加密方式存储的hash值，无法直接反算出密码，如果忘记了密码只能通过重新 <strong><code>随机生成</code></strong> 或者 <strong><code>手动设置</code></strong></p><p>Linux</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 解压下载的文件，得到可执行文件：</span>
<span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> alist-xxxx.tar.gz
<span class="token comment"># 授予程序执行权限：</span>
<span class="token function">chmod</span> +x alist
<span class="token comment"># 运行程序</span>
./alist server

<span class="token comment"># 获得管理员信息 以下两个不同版本，新版本也有随机生成和手动设置</span>
<span class="token comment"># 低于v3.25.0版本</span>
./alist admin

<span class="token comment"># 高于v3.25.0版本</span>
<span class="token comment"># 随机生成一个密码</span>
./alist admin random
<span class="token comment"># 手动设置一个密码 \`NEW_PASSWORD\`是指你需要设置的密码</span>
./alist admin <span class="token builtin class-name">set</span> NEW_PASSWORD
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3)),e("h2",R,[e("a",w,[e("span",null,[e("a",q,[n[29]||(n[29]=s("#")),i(a)]),n[30]||(n[30]=e("strong",null,"守护进程",-1))])])]),n[94]||(n[94]=l(`<p>Linux</p><p>使用任意方式编辑 <code>/usr/lib/systemd/system/alist.service</code> 并添加如下内容，其中 path_alist 为 AList 所在的路径</p><div class="language-ini line-numbers-mode" data-ext="ini" data-title="ini"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Unit</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">Description</span><span class="token punctuation">=</span><span class="token value attr-value">alist</span>
<span class="token key attr-name">After</span><span class="token punctuation">=</span><span class="token value attr-value">network.target</span>
 
<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Service</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">Type</span><span class="token punctuation">=</span><span class="token value attr-value">simple</span>
<span class="token key attr-name">WorkingDirectory</span><span class="token punctuation">=</span><span class="token value attr-value">path_alist</span>
<span class="token key attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">path_alist/alist server</span>
<span class="token key attr-name">Restart</span><span class="token punctuation">=</span><span class="token value attr-value">on-failure</span>
 
<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Install</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">WantedBy</span><span class="token punctuation">=</span><span class="token value attr-value">multi-user.target</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后，执行 <code>systemctl daemon-reload</code> 重载配置，现在你可以使用这些命令来管理程序：</p><ul><li>启动: <code>systemctl start alist</code></li><li>关闭: <code>systemctl stop alist</code></li><li>配置开机自启: <code>systemctl enable alist</code></li><li>取消开机自启: <code>systemctl disable alist</code></li><li>状态: <code>systemctl status alist</code></li><li>重启: <code>systemctl restart alist</code></li></ul>`,5)),e("p",null,[n[33]||(n[33]=s("守护进程不配置? ")),e("a",C,[n[31]||(n[31]=e("strong",null,"视频教程",-1)),n[32]||(n[32]=s("open in new window")),i(a)])]),n[95]||(n[95]=l(`<p>相关信息</p><p>对于所有平台，您可以使用以下命令来静默启动、停止和重新启动。 （v3.4.0 及更高版本）</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 携带\`--force-bin-dir\`参数启动服务</span>
alist start
<span class="token comment"># 通过pid停止服务</span>
alist stop
<span class="token comment"># 通过pid重启服务</span>
alist restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3)),e("h2",O,[e("a",D,[e("span",null,[e("a",S,[n[34]||(n[34]=s("#")),i(a)]),n[35]||(n[35]=e("strong",null,"如何更新",-1))])])]),n[96]||(n[96]=e("p",null,"下载新版Alist，把之前的替换了即可。",-1)),n[97]||(n[97]=e("ul",null,[e("li",null,[s("启动: "),e("code",null,"systemctl start alist")]),e("li",null,[s("关闭: "),e("code",null,"systemctl stop alist")]),e("li",null,[s("状态: "),e("code",null,"systemctl status alist")]),e("li",null,[s("重启: "),e("code",null,"systemctl restart alist")])],-1)),e("h2",B,[e("a",U,[e("span",null,[e("a",N,[n[36]||(n[36]=s("#")),i(a)]),n[37]||(n[37]=e("strong",null,"获取密码",-1))])])]),n[98]||(n[98]=e("p",null,"需要进入脚本安装AList的目录文件夹內执行如下命令",-1)),e("h4",$,[e("a",F,[e("span",null,[e("a",j,[n[38]||(n[38]=s("#")),i(a)]),n[39]||(n[39]=s("低于v3.25.0版本"))])])]),n[99]||(n[99]=e("div",{class:"language-bash line-numbers-mode","data-ext":"sh","data-title":"sh"},[e("pre",{class:"language-bash"},[e("code",null,`./alist admin
`)]),e("div",{class:"line-numbers","aria-hidden":"true"},[e("div",{class:"line-number"})])],-1)),e("h4",z,[e("a",L,[e("span",null,[e("a",G,[n[40]||(n[40]=s("#")),i(a)]),n[41]||(n[41]=s("高于v3.25.0版本"))])])]),n[100]||(n[100]=l(`<p>3.25.0以上版本将密码改成加密方式存储的hash值，无法直接反算出密码，如果忘记了密码只能通过重新 <strong><code>随机生成</code></strong> 或者 <strong><code>手动设置</code></strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 随机生成一个密码</span>
./alist admin random
<span class="token comment"># 手动设置一个密码,\`NEW_PASSWORD\`是指你需要设置的密码</span>
./alist admin <span class="token builtin class-name">set</span> NEW_PASSWORD
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="使用-docker" tabindex="-1"><a class="header-anchor" href="#使用-docker"><span>使用 Docker</span></a></h1><h4 id="低于v3-25-0版本-2" tabindex="-1"><a class="header-anchor" href="#低于v3-25-0版本-2"><span><strong>低于v3.25.0版本</strong></span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> alist ./alist admin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,5)),e("h4",M,[e("a",X,[e("span",null,[e("a",W,[n[42]||(n[42]=s("#")),i(a)]),n[43]||(n[43]=e("strong",null,"高于v3.25.0版本",-1))])])]),n[101]||(n[101]=l(`<p>3.25.0以上版本将密码改成加密方式存储的hash值，无法直接反算出密码，如果忘记了密码只能通过重新 <strong><code>随机生成</code></strong> 或者 <strong><code>手动设置</code></strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 随机生成一个密码</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> alist ./alist admin random
<span class="token comment"># 手动设置一个密码,\`NEW_PASSWORD\`是指你需要设置的密码</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> alist ./alist admin <span class="token builtin class-name">set</span> NEW_PASSWORD
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2)),e("h2",H,[e("a",V,[e("span",null,[e("a",Y,[n[44]||(n[44]=s("#")),i(a)]),n[45]||(n[45]=e("strong",null,"发行版本",-1))])])]),e("h5",K,[e("a",J,[e("span",null,[e("a",Q,[n[46]||(n[46]=s("#")),i(a)]),n[47]||(n[47]=e("strong",null,"docker-cli",-1))])])]),n[102]||(n[102]=l(`<div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--restart</span><span class="token operator">=</span>unless-stopped <span class="token parameter variable">-v</span> /etc/alist:/opt/alist/data <span class="token parameter variable">-p</span> <span class="token number">5244</span>:5244 <span class="token parameter variable">-e</span> <span class="token assign-left variable">PUID</span><span class="token operator">=</span><span class="token number">0</span> <span class="token parameter variable">-e</span> <span class="token assign-left variable">PGID</span><span class="token operator">=</span><span class="token number">0</span> <span class="token parameter variable">-e</span> <span class="token assign-left variable">UMASK</span><span class="token operator">=</span>022 <span class="token parameter variable">--name</span><span class="token operator">=</span><span class="token string">&quot;alist&quot;</span> xhofe/alist:latest
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,1)),e("h5",Z,[e("a",nn,[e("span",null,[e("a",en,[n[48]||(n[48]=s("#")),i(a)]),n[49]||(n[49]=e("strong",null,"docker-compose",-1))])])]),n[103]||(n[103]=l(`<div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3.3&#39;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
    <span class="token key atrule">alist</span><span class="token punctuation">:</span>
        <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">&#39;xhofe/alist:latest&#39;</span>
        <span class="token key atrule">container_name</span><span class="token punctuation">:</span> alist
        <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">&#39;/etc/alist:/opt/alist/data&#39;</span>
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">&#39;5244:5244&#39;</span>
        <span class="token key atrule">environment</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> PUID=0
            <span class="token punctuation">-</span> PGID=0
            <span class="token punctuation">-</span> UMASK=022
        <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>服务运行之后，容器默认的时区为UTC时区，如果你想指定容器运行的时区，则可以通过传递此变量来实现：<code>-e &quot;TZ=Asia/Shanghai&quot;</code>。</p>`,2)),e("h3",sn,[e("a",an,[e("span",null,[e("a",ln,[n[50]||(n[50]=s("#")),i(a)]),n[51]||(n[51]=e("strong",null,"使用 aria2 离线下载",-1))])])]),e("p",null,[n[53]||(n[53]=s("如果你想使用aria2离线下载，我们推荐你使用这个")),e("a",tn,[n[52]||(n[52]=s("imageopen in new window")),i(a)]),n[54]||(n[54]=s("，它预装了aria2。"))]),e("h3",rn,[e("a",dn,[e("span",null,[e("a",on,[n[55]||(n[55]=s("#")),i(a)]),n[56]||(n[56]=e("strong",null,"开发版本",-1))])])]),n[104]||(n[104]=e("p",null,"仅适用于 amd64/arm64。不推荐，这可能无法正常工作。",-1)),e("h5",pn,[e("a",cn,[e("span",null,[e("a",vn,[n[57]||(n[57]=s("#")),i(a)]),n[58]||(n[58]=e("strong",null,"docker-cli",-1))])])]),n[105]||(n[105]=l(`<div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--restart</span><span class="token operator">=</span>unless-stopped <span class="token parameter variable">-v</span> /etc/alist:/opt/alist/data <span class="token parameter variable">-p</span> <span class="token number">5244</span>:5244 <span class="token parameter variable">-e</span> <span class="token assign-left variable">PUID</span><span class="token operator">=</span><span class="token number">0</span> <span class="token parameter variable">-e</span> <span class="token assign-left variable">PGID</span><span class="token operator">=</span><span class="token number">0</span> <span class="token parameter variable">-e</span> <span class="token assign-left variable">UMASK</span><span class="token operator">=</span>022 <span class="token parameter variable">--name</span><span class="token operator">=</span><span class="token string">&quot;alist&quot;</span> xhofe/alist:beta
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,1)),e("h5",un,[e("a",mn,[e("span",null,[e("a",bn,[n[59]||(n[59]=s("#")),i(a)]),n[60]||(n[60]=e("strong",null,"docker-compose",-1))])])]),n[106]||(n[106]=l(`<div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment">#创建一个目录</span>
<span class="token function">mkdir</span> /etc/alist
<span class="token comment">#进入该目录</span>
<span class="token builtin class-name">cd</span> /etc/alist
<span class="token comment">#下载docker-compose.yml文件</span>
<span class="token function">wget</span> https://alist.nn.ci/docker-compose.yml
<span class="token comment">#运行容器</span>
<span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>你也可以自行创建一个包含以下内容的<code>docker-compose.yml</code>文件</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3.3&#39;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
    <span class="token key atrule">alist</span><span class="token punctuation">:</span>
        <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">&#39;xhofe/alist:beta&#39;</span>
        <span class="token key atrule">container_name</span><span class="token punctuation">:</span> alist
        <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">&#39;/etc/alist:/opt/alist/data&#39;</span>
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">&#39;5244:5244&#39;</span>
        <span class="token key atrule">environment</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> PUID=0
            <span class="token punctuation">-</span> PGID=0
            <span class="token punctuation">-</span> UMASK=022
        <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="用户-组标识符" tabindex="-1"><a class="header-anchor" href="#用户-组标识符"><span><strong>用户/组标识符</strong></span></a></h3><p>当使用卷（<code>-v</code> 标志）权限问题时，主机操作系统和容器之间可能会出现权限问题，我们通过允许您指定用户 <code>PUID</code> 和组 <code>PGID</code> 来避免此问题。</p><p>确保主机上的任何卷目录都归您指定的同一用户所有，任何权限问题都会像魔术一样消失。</p><p>在这种情况下，<code>PUID=1000</code> 和 <code>PGID=1000</code>，要找到你的使用 <code>id user</code>，如下所示：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>  $ <span class="token function">id</span> username
    <span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>dockeruser<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>dockergroup<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">(</span>dockergroup<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,8)),e("h3",gn,[e("a",kn,[e("span",null,[e("a",hn,[n[61]||(n[61]=s("#")),i(a)]),n[62]||(n[62]=e("strong",null,"手动编译 Docker 镜像",-1))])])]),n[107]||(n[107]=l(`<p>安装 docker，克隆仓库后进入仓库根目录，无需其他准备</p><p>basic</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">docker</span> build <span class="token parameter variable">-t</span> xhofe/alist:latest <span class="token builtin class-name">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Dockerfile构建</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>
FROM alpine:edge
WORKDIR /opt/alist/

RUN apk update &amp;&amp; \\
    apk upgrade --no-cache &amp;&amp; \\
    apk add --no-cache bash ca-certificates su-exec tzdata wget; \\
    rm -rf /var/cache/apk/*

RUN wget https://github.com/alist-org/alist/releases/latest/download/alist-linux-musl-amd64.tar.gz \\
&amp;&amp; tar -zxvf alist-linux-musl-amd64.tar.gz &amp;&amp; rm -rf alist-linux-musl-amd64.tar.gz &amp;&amp; chmod +x alist

ENV PUID=0 PGID=0 UMASK=022
VOLUME /opt/alist/data/
EXPOSE 5244 5245
CMD [&quot;/opt/alist/alist&quot;, &quot;server&quot;]

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>WORKDIR /anmiao<br> ADD ./alist-linux-amd64.tar.gz /anmiao</p><p>EXPOSE 5244</p><p>CMD [&quot;/anmiao/alist&quot;, &quot;server&quot;]</p><p>docker build -t dkyg/alist:latest .</p><p>docker builder prune</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>
FROM alpine:edge
WORKDIR /opt/alist/
RUN apk update &amp;&amp; \\
    apk upgrade --no-cache &amp;&amp; \\
    apk add --no-cache bash ca-certificates su-exec tzdata; \\
    rm -rf /var/cache/apk/*
ADD ./alist-linux-musl-amd64.tar.gz /opt/alist/
ENV PUID=0 PGID=0 UMASK=022
VOLUME /opt/alist/data/
EXPOSE 5244 5245
CMD [&quot;/opt/alist/alist&quot;, &quot;server&quot;]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其他</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>FROM python:3.12.4-alpine

ENV TZ=Asia/Shanghai

RUN apk update \\
    &amp;&amp; apk upgrade \\
    &amp;&amp; apk add bash \\
    &amp;&amp; rm -rf \\
        /tep \\
        /var/lib/apt/lists \\
        /var/tmp

COPY requirements.txt requirements.txt

RUN pip install --upgrade pip \\
    &amp;&amp; pip install --no-cache-dir -r requirements.txt \\
    &amp;&amp; rm -rf requirements.txt

COPY app /app

VOLUME [&quot;/config&quot;, &quot;/logs&quot;, &quot;/media&quot;]
CMD python /app/main.py

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="从源码运行" tabindex="-1"><a class="header-anchor" href="#从源码运行"><span>从源码运行</span></a></h1><h2 id="环境准备" tabindex="-1"><a class="header-anchor" href="#环境准备"><span><strong>环境准备</strong></span></a></h2><p>首先，你需要一个有<code>git</code>，<code>nodejs</code>，<code>pnpm</code>，<code>golang&gt;=1.20</code>，<code>gcc</code>的环境</p>`,16)),e("h2",xn,[e("a",fn,[e("span",null,[e("a",En,[n[63]||(n[63]=s("#")),i(a)]),n[64]||(n[64]=e("strong",null,"构建前端",-1))])])]),n[108]||(n[108]=e("p",null,[s("使用 "),e("code",null,"git clone --recurse-submodules https://github.com/alist-org/alist-web.git"),s(" 克隆前端 ，执行 "),e("code",null,"pnpm install && pnpm build"),s(" 得到 dist 目录下的目标文件")],-1)),e("h2",yn,[e("a",An,[e("span",null,[e("a",_n,[n[65]||(n[65]=s("#")),i(a)]),n[66]||(n[66]=e("strong",null,"构建后端",-1))])])]),e("p",null,[n[68]||(n[68]=s("克隆 ")),e("a",Tn,[n[67]||(n[67]=s("https://github.com/alist-org/alistopen in new window")),i(a)]),n[69]||(n[69]=s(" ，将上一步的 ")),n[70]||(n[70]=e("code",null,"dist",-1)),n[71]||(n[71]=s(" 目录复制到项目下的 ")),n[72]||(n[72]=e("code",null,"public",-1)),n[73]||(n[73]=s(" 目录下，然后执行："))]),n[109]||(n[109]=l(`<div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token assign-left variable">appName</span><span class="token operator">=</span><span class="token string">&quot;alist&quot;</span>
<span class="token assign-left variable">builtAt</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +<span class="token string">&#39;%F %T %z&#39;</span><span class="token variable">)</span></span>&quot;</span>
<span class="token assign-left variable">goVersion</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>go version <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">&#39;s/go version //&#39;</span><span class="token variable">)</span></span>
<span class="token assign-left variable">gitAuthor</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> show <span class="token parameter variable">-s</span> <span class="token parameter variable">--format</span><span class="token operator">=</span><span class="token string">&#39;format:%aN &lt;%ae&gt;&#39;</span> HEAD<span class="token variable">)</span></span>
<span class="token assign-left variable">gitCommit</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> log <span class="token parameter variable">--pretty</span><span class="token operator">=</span>format:<span class="token string">&quot;%h&quot;</span> <span class="token parameter variable">-1</span><span class="token variable">)</span></span>
<span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> describe <span class="token parameter variable">--long</span> <span class="token parameter variable">--tags</span> <span class="token parameter variable">--dirty</span> <span class="token parameter variable">--always</span><span class="token variable">)</span></span>
<span class="token assign-left variable">webVersion</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">wget</span> -qO- <span class="token parameter variable">-t1</span> <span class="token parameter variable">-T2</span> <span class="token string">&quot;https://api.github.com/repos/alist-org/alist-web/releases/latest&quot;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;tag_name&quot;</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token parameter variable">-F</span> <span class="token string">&quot;:&quot;</span> <span class="token string">&#39;{print $2}&#39;</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">&#39;s/\\&quot;//g;s/,//g;s/ //g&#39;</span><span class="token variable">)</span></span>
<span class="token assign-left variable">ldflags</span><span class="token operator">=</span><span class="token string">&quot;\\
-w -s \\
-X &#39;github.com/alist-org/alist/v3/internal/conf.BuiltAt=<span class="token variable">$builtAt</span>&#39; \\
-X &#39;github.com/alist-org/alist/v3/internal/conf.GoVersion=<span class="token variable">$goVersion</span>&#39; \\
-X &#39;github.com/alist-org/alist/v3/internal/conf.GitAuthor=<span class="token variable">$gitAuthor</span>&#39; \\
-X &#39;github.com/alist-org/alist/v3/internal/conf.GitCommit=<span class="token variable">$gitCommit</span>&#39; \\
-X &#39;github.com/alist-org/alist/v3/internal/conf.Version=<span class="token variable">$version</span>&#39; \\
-X &#39;github.com/alist-org/alist/v3/internal/conf.WebVersion=<span class="token variable">$webVersion</span>&#39; \\
&quot;</span>
go build <span class="token parameter variable">-ldflags</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$ldflags</span>&quot;</span> <span class="token builtin class-name">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="反向代理" tabindex="-1"><a class="header-anchor" href="#反向代理"><span>反向代理</span></a></h1><h2 id="nginx" tabindex="-1"><a class="header-anchor" href="#nginx"><span><strong>nginx</strong></span></a></h2><p>在网站配置文件的 server 字段中添加</p><div class="language-conf line-numbers-mode" data-ext="conf" data-title="conf"><pre class="language-conf"><code>location / {
  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_set_header X-Forwarded-Proto $scheme;
  proxy_set_header Host $http_host;
  proxy_set_header X-Real-IP $remote_addr;
  proxy_set_header Range $http_range;
	proxy_set_header If-Range $http_if_range;
  proxy_redirect off;
  proxy_pass http://127.0.0.1:5244;
  # the max size of file to upload
  client_max_body_size 20000m;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果需要使用HTTP/3，需要将对应<code>HOST</code>行修改为：</p><div class="language-conf line-numbers-mode" data-ext="conf" data-title="conf"><pre class="language-conf"><code>proxy_set_header Host $host:$server_port;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这样修改后的配置同时也可以兼容HTTP/2及更低版本的请求。</p><h3 id="如何对子目录进行反向代理" tabindex="-1"><a class="header-anchor" href="#如何对子目录进行反向代理"><span><strong>如何对子目录进行反向代理？</strong></span></a></h3>`,9)),e("p",null,[n[75]||(n[75]=s("使用 nginx 反向代理到 ")),e("a",Pn,[n[74]||(n[74]=s("https://nn.ci/alistopen in new window")),i(a)]),n[76]||(n[76]=s(" 的示例："))]),e("ul",null,[n[84]||(n[84]=e("li",null,"正常安装",-1)),e("li",null,[n[78]||(n[78]=s("将 ")),e("a",In,[n[77]||(n[77]=s("site_url")),i(a)]),n[79]||(n[79]=s(" 设置为 ")),n[80]||(n[80]=e("code",null,"https://nn.ci/alist",-1)),n[81]||(n[81]=s(" 或者仅")),n[82]||(n[82]=e("code",null,"/alist",-1)),n[83]||(n[83]=s(", 然后重启alist"))]),n[85]||(n[85]=e("li",null,"在 nginx 中添加反向代理配置",-1))]),n[110]||(n[110]=l(`<div class="language-nginx line-numbers-mode" data-ext="nginx" data-title="nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /alist/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-Proto <span class="token variable">$scheme</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$http_host</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> Range <span class="token variable">$http_range</span></span><span class="token punctuation">;</span>
	  <span class="token directive"><span class="token keyword">proxy_set_header</span> If-Range <span class="token variable">$http_if_range</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_redirect</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:5244/alist</span><span class="token punctuation">;</span>
    <span class="token comment"># the max size of file to upload</span>
    <span class="token directive"><span class="token keyword">client_max_body_size</span> <span class="token number">20000m</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1)),e("h3",Rn,[e("a",wn,[e("span",null,[n[86]||(n[86]=s("自动渐变背景")),e("a",qn,[i(a)])])])]),n[111]||(n[111]=l(`<div class="language-html line-numbers-mode" data-ext="html" data-title="html"><pre class="language-html"><code><span class="token comment">&lt;!--放在自定义头部--&gt;</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token comment">/*渐变背景CSS */</span>
<span class="token selector">#canvas-basic</span> <span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
    <span class="token property">z-index</span><span class="token punctuation">:</span> -999<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 <span class="token selector">.hope-ui-light</span> <span class="token punctuation">{</span>
<span class="token property">--hope-colors-background</span><span class="token punctuation">:</span> #f7f8fa00 <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.hope-ui-dark</span> <span class="token punctuation">{</span>
<span class="token property">--hope-colors-background</span><span class="token punctuation">:</span> #f7f8fa00 <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>


<span class="token comment">&lt;!--放在自定义body--&gt;</span>

<span class="token comment">&lt;!-- 渐变背景初始化 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas-basic<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://npm.elemecdn.com/granim@2.0.0/dist/granim.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">var</span> granimInstance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Granim</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token string">&#39;#canvas-basic&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">direction</span><span class="token operator">:</span> <span class="token string">&#39;left-right&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">isPausedWhenNotInView</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">states</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;default-state&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">gradients</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">[</span><span class="token string">&#39;#a18cd1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;#fbc2eb&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                 <span class="token punctuation">[</span><span class="token string">&#39;#fff1eb&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;#ace0f9&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                 <span class="token punctuation">[</span><span class="token string">&#39;#d4fc79&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;#96e6a1&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                 <span class="token punctuation">[</span><span class="token string">&#39;#a1c4fd&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;#c2e9fb&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                 <span class="token punctuation">[</span><span class="token string">&#39;#a8edea&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;#fed6e3&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                 <span class="token punctuation">[</span><span class="token string">&#39;#9890e3&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;#b1f4cf&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                 <span class="token punctuation">[</span><span class="token string">&#39;#a1c4fd&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;#c2e9fb&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                 <span class="token punctuation">[</span><span class="token string">&#39;#fff1eb&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;#ace0f9&#39;</span><span class="token punctuation">]</span>
           
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1))]),n[230]||(n[230]=e("h2",{id:"nginx-1",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#nginx-1"},[e("span",null,"Nginx")])],-1)),e("details",null,[n[115]||(n[115]=l(`<summary>【查看详情】</summary><p>CentOS 7 gcc编译安装Nginx</p><h5 id="安装所需环境" tabindex="-1"><a class="header-anchor" href="#安装所需环境"><span><strong>安装所需环境</strong></span></a></h5><p>Nginx是C语言开发，建议在Linux上运行，当然，也可以安装Windows版本，本篇则使用Linux CentOS 7作为安装环境。</p><h5 id="一、gcc安装" tabindex="-1"><a class="header-anchor" href="#一、gcc安装"><span><strong>一、gcc安装</strong></span></a></h5><p>安装 nginx 需要先将官网下载的源码进行编译，编译依赖 gcc 环境，如果没有 gcc 环境，则需要安装：</p><p>代码语言：javascript</p><p>复制</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>yum install gcc gcc-c++
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="二、pcre-pcre-devel-安装" tabindex="-1"><a class="header-anchor" href="#二、pcre-pcre-devel-安装"><span><strong>二、pcre pcre-devel 安装</strong></span></a></h5><p>PCRE(Perl Compatible Regular Expressions) 是一个Perl库，包括 perl 兼容的正则表达式库。Nginx的http 模块使用pcre来解析正则表达式，所以需要在Linux上安装pcre库，pcre-devel 是使用pcre开发的一个二次开发库。Nginx也需要此库。命令：</p><p>代码语言：javascript</p><p>复制</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>yum install -y pcre pcre-devel
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="三、-zlib安装" tabindex="-1"><a class="header-anchor" href="#三、-zlib安装"><span><strong>三、 zlib安装</strong></span></a></h5><p>zlib 库提供了很多种压缩和解压缩的方式， Nginx使用zlib对http包的内容进行gzip，所以需要在Linux Centos 7上安装zlib库。</p><p>代码语言：javascript</p><p>复制</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>yum install -y zlib zlib-devel
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="四、openssl安装" tabindex="-1"><a class="header-anchor" href="#四、openssl安装"><span><strong>四、openssl安装</strong></span></a></h5><p>OpenSSL是一个强大的安全套接字层密码库，囊括主要的密码算法、常用的密钥和证书封装管理功能及SSL协议，并提供丰富的应用程序供测试或其它目的使用。 Nginx不仅支持http协议，还支持https（即在ssl协议上传输http），所以需要在Linux Centos 7安装OpenSSL库。</p><p>代码语言：javascript</p><p>复制</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>yum install -y openssl openssl-devel



# 解压到当前目录
tar zxvf openssl-1.0.2k.tar.gz
# 进入目录
cd openssl-1.0.2k
# 配置编译，指定安装目录
./config
# 进行编译并安装
make &amp;&amp; make install
备份之前 OpenSSL 版本的文件，以方便恢复。



echo &quot;/usr/local/lib64/&quot; &gt;&gt; /etc/ld.so.conf

ldconfig

mv /usr/bin/openssl /usr/bin/openssl.old

ln -s /usr/local/bin/openssl /usr/bin/openssl

openssl version -a



方法2

cd openssl-1.0.2k

#./config -fPIC --prefix=/usr/local/openssl/ enable-shared

./config shared zlib

make

make install

mv /usr/bin/openssl /usr/bin/openssl.bak

mv /usr/include/openssl /usr/include/openssl.bak

ln -s /usr/local/openssl/bin/openssl /usr/bin/openssl

ln -s /usr/local/openssl/include/openssl /usr/include/openssl

ln -s /usr/local/lib64/libssl.so.1.1 /usr/lib64/libssl.so.1.1

ln -s /usr/local/lib64/libcrypto.so.1.1 /usr/lib64/libcrypto.so.1.1

echo “/usr/local/openssl/lib” &gt;&gt; /etc/ld.so.conf

ldconfig -v

5、查看是否升级成功[root@localhost ~]# openssl version -a

解决 openssl: error while loading shared libraries: libssl.so.1.1: cannot open shared object file: No such file or directory错误问题

在Centos7上编译安装openssl后，运行openssl version出现如下错误：

openssl: error while loading shared libraries: libssl.so.1.1: cannot open shared object file: No such file or directory

这是由于openssl库的位置不正确造成的。解决方法是在root用户下执行：ln -s /usr/local/lib64/libssl.so.1.1 /usr/lib64/libssl.so.1.1

ln -s /usr/local/lib64/libcrypto.so.1.1 /usr/lib64/libcrypto.so.1.1


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="五、下载nginx" tabindex="-1"><a class="header-anchor" href="#五、下载nginx"><span><strong>五、下载Nginx</strong></span></a></h5>`,25)),e("p",null,[n[113]||(n[113]=e("strong",null,"1. 官网下载",-1)),n[114]||(n[114]=s(" 直接下载.tar.gz安装包，地址：")),e("a",Cn,[n[112]||(n[112]=s("https://nginx.org/en/download.html")),i(a)])]),n[116]||(n[116]=l(`<hr><p><strong>2. wget下载</strong> 使用wget命令下载（推荐）。确保系统已经安装了wget，如果没有安装，执行 yum install wget 安装。我下载的是1.26.0版本，这个是目前的稳定版。</p><p>代码语言：javascript</p><p>复制</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>wget -c https://nginx.org/download/nginx-1.26.0.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><hr><p><strong>3. 解压</strong> 依然是直接命令：</p><p>代码语言：javascript</p><p>复制</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>tar -zxvf nginx-1.26.0.tar.gz
cd nginx-1.26.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><hr><p><strong>4. 配置</strong> 其实在 nginx-1.26.0 版本中你就不需要去配置相关东西，默认就可以了。当然，如果你要自己配置目录也是可以的。</p><ul><li>4.1 使用默认配置</li></ul><p>代码语言：javascript</p><p>复制</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code># Ubuntu中nginx安装
sudo apt update
sudo apt install build-essential
sudo apt install libpcre3 libpcre3-dev
sudo apt install zlib1g zlib1g-dev
sudo apt install openssl libssl-dev

./configure

./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module

##openssl源解压路径

./configure --prefix=/usr/local/nginx --with-http_stub_status_module  --with-http_ssl_module --with-openssl=/root/openssl-1.1.1s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>4.2 自定义配置（不推荐）</li></ul><p>代码语言：javascript</p><p>复制</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>./configure \\
--prefix=/usr/local/nginx \\
--conf-path=/usr/local/nginx/conf/nginx.conf \\
--pid-path=/usr/local/nginx/conf/nginx.pid \\
--lock-path=/var/lock/nginx.lock \\
--error-log-path=/var/log/nginx/error.log \\
--http-log-path=/var/log/nginx/access.log \\
--with-http_gzip_static_module \\
--http-client-body-temp-path=/var/temp/nginx/client \\
--http-proxy-temp-path=/var/temp/nginx/proxy \\
--http-fastcgi-temp-path=/var/temp/nginx/fastcgi \\
--http-uwsgi-temp-path=/var/temp/nginx/uwsgi \\
--http-scgi-temp-path=/var/temp/nginx/scgi
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>**注：**将临时文件目录指定为/var/temp/nginx，需要在/var下创建temp及nginx目录</p><hr><p><strong>5. 编译安装</strong></p><p>代码语言：javascript</p><p>复制</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>make
make install
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><hr><p><strong>6. 查找安装路径</strong></p><p>代码语言：javascript</p><p>复制</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>whereis nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><hr><p><strong>7. 启动、停止nginx</strong></p><p>代码语言：javascript</p><p>复制</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>cd /usr/local/nginx/sbin/
./nginx 
./nginx -s stop
./nginx -s quit
./nginx -s reload
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><p>代码语言：javascript</p><p>复制</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code># 注：启动时报80端口被占用:
nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>解决办法：安装net-tool包：yum install net-tools</p><p>代码语言：javascript</p><p>复制</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>./nginx -s quit # 此方式停止步骤是待nginx进程处理任务完毕进行停止。
./nginx -s stop # 此方式相当于先查出nginx进程id再使用kill命令强制杀掉进程。
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><hr><p><strong>8. 查询nginx进程</strong></p><p>代码语言：javascript</p><p>复制</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>ps aux|grep nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><hr><p><strong>9. 重启 nginx</strong></p><ul><li>9.1 先停止再启动（推荐）： 对 nginx 进行重启相当于先停止再启动，即先执行停止命令再执行启动命令。如下：</li></ul><p>代码语言：javascript</p><p>复制</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>./nginx -s quit
./nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>9.2 重新加载配置文件： 当 ngin x的配置文件 nginx.conf 修改后，要想让配置生效需要重启 nginx，使用-s reload不用先停止 ngin x再启动 nginx 即可将配置信息在 nginx 中生效，如下：</li></ul><p>代码语言：javascript</p><p>复制</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>./nginx -s reload
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><hr><p><strong>10. 启动成功</strong> 在浏览器可以看到这样的页面，即表示启动成功</p><hr><h5 id="六、开机自启动" tabindex="-1"><a class="header-anchor" href="#六、开机自启动"><span><strong>六、开机自启动</strong></span></a></h5><p>即在rc.local增加启动代码就可以了。</p><p>代码语言：javascript</p><p>复制</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>vi /etc/rc.local
# 增加如下代码
/usr/local/nginx/sbin/nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>设置执行权限：</p><p>代码语言：javascript</p><p>复制</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>chmod 755 rc.local
nginx-rclocal.png
关闭防火墙
systemctl stop firewalld.service
systemctl disable firewalld.service
放行端口
firewall-cmd --zone=public --add-port=80/tcp --permanent

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="nginx-systemctl启动配置" tabindex="-1"><a class="header-anchor" href="#nginx-systemctl启动配置"><span><strong>nginx systemctl启动配置</strong></span></a></h4><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>vi /usr/lib/systemd/system/nginx.service

chmod +x /usr/lib/systemd/system/nginx.service

（1）进入 cd /usr/local/nginx/conf/ 目录，编辑配置文件nginx.conf ；
（2）在配置文件中有个注释的地方： #pid        logs/nginx.pid;　　　
（3）将注释放开，并修改为：pid    /usr/local/nginx/logs/nginx.pid;


[Unit]
Description=The nginx HTTP and reverse proxy server
After=syslog.target network.target remote-fs.target nss-lookup.target

[Service]
Type=forking
PIDFile=/usr/local/nginx/logs/nginx.pid  
ExecStartPre=/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.conf
ExecStart=/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf
ExecReload=/usr/local/nginx/sbin/nginx -s reload
ExecStop=/usr/local/nginx/sbin/nginx -s stop
ExecQuit=/usr/local/nginx/sbin/nginx -s quit
PrivateTmp=true

[Install]
WantedBy=multi-user.target
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3.启动服务</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>在启动服务之前，需要先重载systemctl命令
systemctl daemon-reload

ps -ef | grep nginx

systemctl start nginx.service
systemctl stop nginx.service
systemctl restart nginx.service

systemctl status nginx.service      nginx状态

systemctl enable nginx.service      开机自启


备份nginx conf

cp /usr/local/nginx/conf/nginx.conf /usr/local/nginx/conf/nginx.conf.bak2

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="卸载-nginx" tabindex="-1"><a class="header-anchor" href="#卸载-nginx"><span><strong>卸载 nginx</strong></span></a></h4><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>#卸载nginx
whereis nginx

find / -name nginx

rm -rf /usr/local/nginx /usr/local/sbin/nginx

yum remove nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>NGINX默认配置</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>
#user  nobody;
worker_processes  1;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;


events {
    worker_connections  1024;
}


http {
    include       mime.types;
   
    default_type  application/octet-stream;

    #log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;
    #                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;
    #                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;

    #access_log  logs/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65;

    #gzip  on;
    include /usr/local/nginx/conf/conf.d/*.conf;

    server {
        listen       80;
        server_name  localhost;

        #charset koi8-r;

        #access_log  logs/host.access.log  main;

        location / {
            root   html;
            index  index.html index.htm;
        }

        #error_page  404              /404.html;

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }

        # proxy the PHP scripts to Apache listening on 127.0.0.1:80
        #
        #location ~ \\.php$ {
        #    proxy_pass   http://127.0.0.1;
        #}

        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        #
        #location ~ \\.php$ {
        #    root           html;
        #    fastcgi_pass   127.0.0.1:9000;
        #    fastcgi_index  index.php;
        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
        #    include        fastcgi_params;
        #}

        # deny access to .htaccess files, if Apache&#39;s document root
        # concurs with nginx&#39;s one
        #
        #location ~ /\\.ht {
        #    deny  all;
        #}
    }


    # another virtual host using mix of IP-, name-, and port-based configuration
    #
    #server {
    #    listen       8000;
    #    listen       somename:8080;
    #    server_name  somename  alias  another.alias;

    #    location / {
    #        root   html;
    #        index  index.html index.htm;
    #    }
    #}


    # HTTPS server
    #
    #server {
    #    listen       443 ssl;
    #    server_name  localhost;

    #    ssl_certificate      cert.pem;
    #    ssl_certificate_key  cert.key;

    #    ssl_session_cache    shared:SSL:1m;
    #    ssl_session_timeout  5m;

    #    ssl_ciphers  HIGH:!aNULL:!MD5;
    #    ssl_prefer_server_ciphers  on;

    #    location / {
    #        root   html;
    #        index  index.html index.htm;
    #    }
    #}

}



</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,79))]),n[231]||(n[231]=e("h2",{id:"openwrt扩容overlay",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#openwrt扩容overlay"},[e("span",null,"OpenWrt扩容overlay")])],-1)),e("details",null,[n[120]||(n[120]=l(`<summary>【查看详情】</summary><p>此教程根据E-SIR大神视频整理，侵删<br> overlay分区扩容教程<br> （此教程仅适用于E-SIR大神制作的固件 ）</p><p>ssh连接你的X86-openwrt路由器</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>Microsoft Windows [版本 10.0.19041.450]

(c) 2021 Microsoft Corporation. 保留所有权利。

 

PS C:\\Users\\ASUS&gt; ssh root@192.168.5.1

root@192.168.5.1&#39;s password:

BusyBox v1.31.1 () built-in shell (ash)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><p>| |.-----.-----.-----.| | | |.----.| |_</p><p>| - || _ | -__| || | | || _|| _|</p><p>|___<strong><strong>|| <strong>|</strong><em><strong>|</strong>|</em><em>||</em>_____<strong>||</strong>| |</strong></strong>|</p><pre><code>      |__| W I R E L E S S   F R E E D O M
</code></pre><hr><p>OpenWrt GDQ v1.1[2021] | by &quot;eSir PlayGround&quot;</p><hr><p><strong>root@OpenWrt:~# lsblk</strong></p><p>NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT</p><p>loop0 7:0 0 51.4M 0 loop /mnt/loop0</p><p>sda 8:0 0 7.5G 0 disk</p><p>├─sda1 8:1 0 16M 0 part /mnt/sda1</p><p>└─sda2 8:2 0 300M 0 part /rom</p><p><strong>root@OpenWrt:~# cfdisk</strong></p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>如果没有cfdisk命令，则使用 opkg install cfdisk 安装）

因为我的系统使用的是固态硬盘，所以默认挂载点不是从/dev/sda开始的，直接使用cfdisk命令会报错：

cfdisk: cannot open /dev/sda: No such file or directory 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>  所以用 fdisk -l 命令，查看自己硬盘挂载点

fdisk -l

Disk /dev/nvme0n1: 931.51 GiB, 1000204886016 bytes, 1953525168 sectors

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 比如我这里，查看自己硬盘挂载点为 /dev/nvme0n1 后，</p><pre><code>  使用 cfdisk /dev/nvme0n1 进入下图分区工具界面 
</code></pre><p>（上下键控制上面的光标移动，左右键控制下面的光标移动）</p><p>光标上下移动至Free space，左右移至New，回车<br> 大小自己选择1G或者默认不变<br> 回车<br> 光标移至Write，回车<br> 输入yes，回车<br> 光标左右移动至Write后回车，然后移动至Quit回车退出</p><p>Syncing disks.</p><p><strong>root@OpenWrt:~# mkfs.ext4 /dev/sda3</strong></p><p>mke2fs 1.45.6 (20-Mar-2020)</p><p>Creating filesystem with 1101056 4k blocks and 275264 inodes</p><p>Filesystem UUID: a686d37a-c77f-4a12-8e05-222ace47ae00</p><p>Superblock backups stored on blocks:</p><pre><code>    32768, 98304, 163840, 229376, 294912, 819200, 884736
</code></pre><p>Allocating group tables: done</p><p>Writing inode tables: done</p><p>Creating journal (16384 blocks): done</p><p>Writing superblocks and filesystem accounting information: done</p><p><strong>root@OpenWrt:~# mount /dev/sda3 /mnt/sda3</strong></p><p>root@OpenWrt:~# <strong>ls /mnt/sda3</strong></p><p>lost+found</p><p>root@OpenWrt:~# <strong>cd /overlay</strong></p><p>root@OpenWrt:/overlay# <strong>ls</strong></p><p>upper work</p><p>root@OpenWrt:/overlay# <strong>cd upper</strong></p><p>root@OpenWrt:/overlay/upper# <strong>ls</strong></p><p>boot etc home htdocs lib mnt opt root run usr www</p><p>root@OpenWrt:/overlay/upper# <strong>cd ..</strong></p><p>root@OpenWrt:/overlay# <strong>cd ..</strong></p><p><em><em>root@OpenWrt:/# cp -r /overlay/</em> /mnt/sda3</em>*</p><p>root@OpenWrt:/# <strong>ls /mnt/sda3</strong></p><p><strong>lost+found upper work</strong></p><p>简化方法</p><p>进入路由器后台，系统-挂载点<br> 点“添加”<br> 选中“启用此挂载点&quot;, 根据UUID指定你前面新建分区大小的UUID，挂载点为”作为外部overlay使用“，然后保存&amp;应用<br> 保存并应用后，重启你的设备，再打开网页，就可以看到软件包空间变大了</p>`,52)),e("p",null,[n[118]||(n[118]=s("本文禁止转载或摘编 作者：吾爱探索 ")),e("a",On,[n[117]||(n[117]=s("https://www.bilibili.com/read/cv9304632/")),i(a)]),n[119]||(n[119]=s(" 出处：bilibili"))])]),n[232]||(n[232]=e("h2",{id:"iptables",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#iptables"},[e("span",null,"iptables")])],-1)),e("details",null,[n[151]||(n[151]=e("summary",null,"【查看详情】",-1)),n[152]||(n[152]=e("h1",{id:"iptables-1",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#iptables-1"},[e("span",null,"iptables")])],-1)),n[153]||(n[153]=e("p",null,"Linux上常用的防火墙软件",-1)),n[154]||(n[154]=e("h2",{id:"补充说明",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#补充说明"},[e("span",null,"补充说明")])],-1)),n[155]||(n[155]=e("p",null,[e("strong",null,"iptables命令"),s(" 是Linux上常用的防火墙软件，是netfilter项目的一部分。可以直接配置，也可以通过许多前端和图形界面配置。")],-1)),e("ul",null,[e("li",null,[n[123]||(n[123]=s("补充说明 ")),e("ul",null,[e("li",null,[e("a",Dn,[n[121]||(n[121]=s("语法")),i(a)])]),e("li",null,[e("a",Sn,[n[122]||(n[122]=s("选项")),i(a)])])])]),e("li",null,[n[148]||(n[148]=s("基本参数 ")),e("ul",null,[e("li",null,[e("a",Bn,[n[124]||(n[124]=s("命令选项输入顺序")),i(a)])]),e("li",null,[e("a",Un,[n[125]||(n[125]=s("工作机制")),i(a)])]),e("li",null,[e("a",Nn,[n[126]||(n[126]=s("防火墙的策略")),i(a)])]),e("li",null,[e("a",$n,[n[127]||(n[127]=s("防火墙的策略")),i(a)])]),e("li",null,[n[147]||(n[147]=s("实例 ")),e("ul",null,[e("li",null,[e("a",Fn,[n[128]||(n[128]=s("清空当前的所有规则和计数")),i(a)])]),e("li",null,[e("a",jn,[n[129]||(n[129]=s("配置允许ssh端口连接")),i(a)])]),e("li",null,[e("a",zn,[n[130]||(n[130]=s("允许本地回环地址可以正常使用")),i(a)])]),e("li",null,[e("a",Ln,[n[131]||(n[131]=s("设置默认的规则")),i(a)])]),e("li",null,[e("a",Gn,[n[132]||(n[132]=s("配置白名单")),i(a)])]),e("li",null,[e("a",Mn,[n[133]||(n[133]=s("开启相应的服务端口")),i(a)])]),e("li",null,[e("a",Xn,[n[134]||(n[134]=s("保存规则到配置文件中")),i(a)])]),e("li",null,[e("a",Wn,[n[135]||(n[135]=s("列出已设置的规则")),i(a)])]),e("li",null,[e("a",Hn,[n[136]||(n[136]=s("清除已有规则")),i(a)])]),e("li",null,[e("a",Vn,[n[137]||(n[137]=s("删除已添加的规则")),i(a)])]),e("li",null,[e("a",Yn,[n[138]||(n[138]=s("开放指定的端口")),i(a)])]),e("li",null,[e("a",Kn,[n[139]||(n[139]=s("屏蔽IP")),i(a)])]),e("li",null,[e("a",Jn,[n[140]||(n[140]=s("指定数据包出去的网络接口")),i(a)])]),e("li",null,[e("a",Qn,[n[141]||(n[141]=s("查看已添加的规则")),i(a)])]),e("li",null,[e("a",Zn,[n[142]||(n[142]=s("启动网络转发规则")),i(a)])]),e("li",null,[e("a",ne,[n[143]||(n[143]=s("端口映射")),i(a)])]),e("li",null,[e("a",ee,[n[144]||(n[144]=s("字符串匹配")),i(a)])]),e("li",null,[e("a",se,[n[145]||(n[145]=s("阻止Windows蠕虫的攻击")),i(a)])]),e("li",null,[e("a",ae,[n[146]||(n[146]=s("防止SYN洪水攻击")),i(a)])])])])])])]),n[156]||(n[156]=l(`<h3 id="语法" tabindex="-1"><a class="header-anchor" href="#语法"><span>语法</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables<span class="token punctuation">(</span>选项<span class="token punctuation">)</span><span class="token punctuation">(</span>参数<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="选项" tabindex="-1"><a class="header-anchor" href="#选项"><span>选项</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>-t, <span class="token parameter variable">--table</span> table 对指定的表 table 进行操作， table 必须是 raw， nat，filter，mangle 中的一个。如果不指定此选项，默认的是 filter 表。

<span class="token comment"># 通用匹配：源地址目标地址的匹配</span>
-p：指定要匹配的数据包协议类型；
-s, <span class="token parameter variable">--source</span> <span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> address<span class="token punctuation">[</span>/mask<span class="token punctuation">]</span> ：把指定的一个／一组地址作为源地址，按此规则进行过滤。当后面没有 mask 时，address 是一个地址，比如：192.168.1.1；当 mask 指定时，可以表示一组范围内的地址，比如：192.168.1.0/255.255.255.0。
-d, <span class="token parameter variable">--destination</span> <span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> address<span class="token punctuation">[</span>/mask<span class="token punctuation">]</span> ：地址格式同上，但这里是指定地址为目的地址，按此进行过滤。
-i, --in-interface <span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span>网络接口name<span class="token operator">&gt;</span> ：指定数据包的来自来自网络接口，比如最常见的 eth0 。注意：它只对 INPUT，FORWARD，PREROUTING 这三个链起作用。如果没有指定此选项， 说明可以来自任何一个网络接口。同前面类似，<span class="token string">&quot;!&quot;</span> 表示取反。
-o, --out-interface <span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span>网络接口name<span class="token operator">&gt;</span> ：指定数据包出去的网络接口。只对 OUTPUT，FORWARD，POSTROUTING 三个链起作用。

<span class="token comment"># 查看管理命令</span>
-L, <span class="token parameter variable">--list</span> <span class="token punctuation">[</span>chain<span class="token punctuation">]</span> 列出链 chain 上面的所有规则，如果没有指定链，列出表上所有链的所有规则。

<span class="token comment"># 规则管理命令</span>
-A, <span class="token parameter variable">--append</span> chain rule-specification 在指定链 chain 的末尾插入指定的规则，也就是说，这条规则会被放到最后，最后才会被执行。规则是由后面的匹配来指定。
-I, <span class="token parameter variable">--insert</span> chain <span class="token punctuation">[</span>rulenum<span class="token punctuation">]</span> rule-specification 在链 chain 中的指定位置插入一条或多条规则。如果指定的规则号是1，则在链的头部插入。这也是默认的情况，如果没有指定规则号。
-D, <span class="token parameter variable">--delete</span> chain rule-specification -D, <span class="token parameter variable">--delete</span> chain rulenum 在指定的链 chain 中删除一个或多个指定规则。
<span class="token parameter variable">-R</span> num：Replays替换/修改第几条规则

<span class="token comment"># 链管理命令（这都是立即生效的）</span>
-P, <span class="token parameter variable">--policy</span> chain target ：为指定的链 chain 设置策略 target。注意，只有内置的链才允许有策略，用户自定义的是不允许的。
-F, <span class="token parameter variable">--flush</span> <span class="token punctuation">[</span>chain<span class="token punctuation">]</span> 清空指定链 chain 上面的所有规则。如果没有指定链，清空该表上所有链的所有规则。
-N, --new-chain chain 用指定的名字创建一个新的链。
-X, --delete-chain <span class="token punctuation">[</span>chain<span class="token punctuation">]</span> ：删除指定的链，这个链必须没有被其它任何规则引用，而且这条上必须没有任何规则。如果没有指定链名，则会删除该表中所有非内置的链。
-E, --rename-chain old-chain new-chain ：用指定的新名字去重命名指定的链。这并不会对链内部造成任何影响。
-Z, <span class="token parameter variable">--zero</span> <span class="token punctuation">[</span>chain<span class="token punctuation">]</span> ：把指定链，或者表中的所有链上的所有计数器清零。

-j, <span class="token parameter variable">--jump</span> target <span class="token operator">&lt;</span>指定目标<span class="token operator">&gt;</span> ：即满足某条件时该执行什么样的动作。target 可以是内置的目标，比如 ACCEPT，也可以是用户自定义的链。
-h：显示帮助信息；
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="基本参数" tabindex="-1"><a class="header-anchor" href="#基本参数"><span>基本参数</span></a></h2><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>-P</td><td>设置默认策略:iptables -P INPUT (DROP</td></tr><tr><td>-F</td><td>清空规则链</td></tr><tr><td>-L</td><td>查看规则链</td></tr><tr><td>-A</td><td>在规则链的末尾加入新规则</td></tr><tr><td>-I</td><td>num 在规则链的头部加入新规则</td></tr><tr><td>-D</td><td>num 删除某一条规则</td></tr><tr><td>-s</td><td>匹配来源地址IP/MASK，加叹号&quot;!&quot;表示除这个IP外。</td></tr><tr><td>-d</td><td>匹配目标地址</td></tr><tr><td>-i</td><td>网卡名称 匹配从这块网卡流入的数据</td></tr><tr><td>-o</td><td>网卡名称 匹配从这块网卡流出的数据</td></tr><tr><td>-p</td><td>匹配协议,如tcp,udp,icmp</td></tr><tr><td>--dport num</td><td>匹配目标端口号</td></tr><tr><td>--sport num</td><td>匹配来源端口号</td></tr></tbody></table><h4 id="命令选项输入顺序" tabindex="-1"><a class="header-anchor" href="#命令选项输入顺序"><span>命令选项输入顺序</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-t</span> 表名 <span class="token operator">&lt;</span>-A/I/D/R<span class="token operator">&gt;</span> 规则链名 <span class="token punctuation">[</span>规则号<span class="token punctuation">]</span> <span class="token operator">&lt;</span>-i/o 网卡名<span class="token operator">&gt;</span> <span class="token parameter variable">-p</span> 协议名 <span class="token operator">&lt;</span>-s 源IP/源子网<span class="token operator">&gt;</span> <span class="token parameter variable">--sport</span> 源端口 <span class="token operator">&lt;</span>-d 目标IP/目标子网<span class="token operator">&gt;</span> <span class="token parameter variable">--dport</span> 目标端口 <span class="token parameter variable">-j</span> 动作
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="工作机制" tabindex="-1"><a class="header-anchor" href="#工作机制"><span>工作机制</span></a></h4><p>规则链名包括(也被称为五个钩子函数（hook functions）)：</p><ul><li><strong>INPUT链</strong> ：处理输入数据包。</li><li><strong>OUTPUT链</strong> ：处理输出数据包。</li><li><strong>FORWARD链</strong> ：处理转发数据包。</li><li><strong>PREROUTING链</strong> ：用于目标地址转换（DNAT）。</li><li><strong>POSTOUTING链</strong> ：用于源地址转换（SNAT）。</li></ul><h4 id="防火墙的策略" tabindex="-1"><a class="header-anchor" href="#防火墙的策略"><span>防火墙的策略</span></a></h4><p>防火墙策略一般分为两种，一种叫<code>通</code>策略，一种叫<code>堵</code>策略，通策略，默认门是关着的，必须要定义谁能进。堵策略则是，大门是洞开的，但是你必须有身份认证，否则不能进。所以我们要定义，让进来的进来，让出去的出去，<code>所以通，是要全通，而堵，则是要选择</code>。当我们定义的策略的时候，要分别定义多条功能，其中：定义数据包中允许或者不允许的策略，filter过滤的功能，而定义地址转换的功能的则是nat选项。为了让这些功能交替工作，我们制定出了“表”这个定义，来定义、区分各种不同的工作功能和处理方式。</p><p>我们现在用的比较多个功能有3个：</p><ol><li>filter 定义允许或者不允许的，只能做在3个链上：INPUT ，FORWARD ，OUTPUT</li><li>nat 定义地址转换的，也只能做在3个链上：PREROUTING ，OUTPUT ，POSTROUTING</li><li>mangle功能:修改报文原数据，是5个链都可以做：PREROUTING，INPUT，FORWARD，OUTPUT，POSTROUTING</li></ol><p>我们修改报文原数据就是来修改TTL的。能够实现将数据包的元数据拆开，在里面做标记/修改内容的。而防火墙标记，其实就是靠mangle来实现的。</p><p>小扩展:</p><ul><li>对于filter来讲一般只能做在3个链上：INPUT ，FORWARD ，OUTPUT</li><li>对于nat来讲一般也只能做在3个链上：PREROUTING ，OUTPUT ，POSTROUTING</li><li>而mangle则是5个链都可以做：PREROUTING，INPUT，FORWARD，OUTPUT，POSTROUTING</li></ul><p>iptables/netfilter（这款软件）是工作在用户空间的，它可以让规则进行生效的，本身不是一种服务，而且规则是立即生效的。而我们iptables现在被做成了一个服务，可以进行启动，停止的。启动，则将规则直接生效，停止，则将规则撤销。</p><p>iptables还支持自己定义链。但是自己定义的链，必须是跟某种特定的链关联起来的。在一个关卡设定，指定当有数据的时候专门去找某个特定的链来处理，当那个链处理完之后，再返回。接着在特定的链中继续检查。</p><p>注意：规则的次序非常关键，<code>谁的规则越严格，应该放的越靠前</code>，而检查规则的时候，是按照从上往下的方式进行检查的。</p><p>表名包括：</p><ul><li><strong>raw</strong> ：高级功能，如：网址过滤。</li><li><strong>mangle</strong> ：数据包修改（QOS），用于实现服务质量。</li><li><strong>nat</strong> ：地址转换，用于网关路由器。</li><li><strong>filter</strong> ：包过滤，用于防火墙规则。</li></ul><p>动作包括：</p><ul><li><strong>ACCEPT</strong> ：接收数据包。</li><li><strong>DROP</strong> ：丢弃数据包。</li><li><strong>REDIRECT</strong> ：重定向、映射、透明代理。</li><li><strong>SNAT</strong> ：源地址转换。</li><li><strong>DNAT</strong> ：目标地址转换。</li><li><strong>MASQUERADE</strong> ：IP伪装（NAT），用于ADSL。</li><li><strong>LOG</strong> ：日志记录。</li><li><strong>SEMARK</strong> : 添加SEMARK标记以供网域内强制访问控制（MAC）</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>                             ┏╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍┓
 ┌───────────────┐           ┃    Network    ┃
 │ table: filter │           ┗━━━━━━━┳━━━━━━━┛
 │ chain: INPUT  │◀────┐             │
 └───────┬───────┘     │             ▼
         │             │   ┌───────────────────┐
  ┌      ▼      ┐      │   │ table: nat        │
  │local process│      │   │ chain: PREROUTING │
  └             ┘      │   └─────────┬─────────┘
         │             │             │
         ▼             │             ▼              ┌─────────────────┐
┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅    │     ┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅      │table: nat       │
 Routing decision      └───── outing decision ─────▶│chain: PREROUTING│
┅┅┅┅┅┅┅┅┅┳┅┅┅┅┅┅┅┅┅          ┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅      └────────┬────────┘
         │                                                   │
         ▼                                                   │
 ┌───────────────┐                                           │
 │ table: nat    │           ┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅               │
 │ chain: OUTPUT │    ┌─────▶ outing decision ◀──────────────┘
 └───────┬───────┘    │      ┅┅┅┅┅┅┅┅┳┅┅┅┅┅┅┅┅
         │            │              │
         ▼            │              ▼
 ┌───────────────┐    │   ┌────────────────────┐
 │ table: filter │    │   │ chain: POSTROUTING │
 │ chain: OUTPUT ├────┘   └──────────┬─────────┘
 └───────────────┘                   │
                                     ▼
                             ┏╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍┓
                             ┃    Network    ┃
                             ┗━━━━━━━━━━━━━━━┛
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实例" tabindex="-1"><a class="header-anchor" href="#实例"><span>实例</span></a></h3><h4 id="清空当前的所有规则和计数" tabindex="-1"><a class="header-anchor" href="#清空当前的所有规则和计数"><span>清空当前的所有规则和计数</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-F</span>  <span class="token comment"># 清空所有的防火墙规则</span>
iptables <span class="token parameter variable">-X</span>  <span class="token comment"># 删除用户自定义的空链</span>
iptables <span class="token parameter variable">-Z</span>  <span class="token comment"># 清空计数</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="配置允许ssh端口连接" tabindex="-1"><a class="header-anchor" href="#配置允许ssh端口连接"><span>配置允许ssh端口连接</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">192.168</span>.1.0/24 <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">22</span> <span class="token parameter variable">-j</span> ACCEPT
<span class="token comment"># 22为你的ssh端口， -s 192.168.1.0/24表示允许这个网段的机器来连接，其它网段的ip地址是登陆不了你的机器的。 -j ACCEPT表示接受这样的请求</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="允许本地回环地址可以正常使用" tabindex="-1"><a class="header-anchor" href="#允许本地回环地址可以正常使用"><span>允许本地回环地址可以正常使用</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-i</span> lo <span class="token parameter variable">-j</span> ACCEPT
<span class="token comment">#本地圆环地址就是那个127.0.0.1，是本机上使用的,它进与出都设置为允许</span>
iptables <span class="token parameter variable">-A</span> OUTPUT <span class="token parameter variable">-o</span> lo <span class="token parameter variable">-j</span> ACCEPT
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="设置默认的规则" tabindex="-1"><a class="header-anchor" href="#设置默认的规则"><span>设置默认的规则</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-P</span> INPUT DROP <span class="token comment"># 配置默认的不让进</span>
iptables <span class="token parameter variable">-P</span> FORWARD DROP <span class="token comment"># 默认的不允许转发</span>
iptables <span class="token parameter variable">-P</span> OUTPUT ACCEPT <span class="token comment"># 默认的可以出去</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="配置白名单" tabindex="-1"><a class="header-anchor" href="#配置白名单"><span>配置白名单</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> all <span class="token parameter variable">-s</span> <span class="token number">192.168</span>.1.0/24 <span class="token parameter variable">-j</span> ACCEPT  <span class="token comment"># 允许机房内网机器可以访问</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> all <span class="token parameter variable">-s</span> <span class="token number">192.168</span>.140.0/24 <span class="token parameter variable">-j</span> ACCEPT  <span class="token comment"># 允许机房内网机器可以访问</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">-s</span> <span class="token number">183.121</span>.3.7 <span class="token parameter variable">--dport</span> <span class="token number">3380</span> <span class="token parameter variable">-j</span> ACCEPT <span class="token comment"># 允许183.121.3.7访问本机的3380端口</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="开启相应的服务端口" tabindex="-1"><a class="header-anchor" href="#开启相应的服务端口"><span>开启相应的服务端口</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">80</span> <span class="token parameter variable">-j</span> ACCEPT <span class="token comment"># 开启80端口，因为web对外都是这个端口</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> icmp --icmp-type <span class="token number">8</span> <span class="token parameter variable">-j</span> ACCEPT <span class="token comment"># 允许被ping</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-m</span> state <span class="token parameter variable">--state</span> ESTABLISHED,RELATED <span class="token parameter variable">-j</span> ACCEPT <span class="token comment"># 已经建立的连接得让它进来</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="保存规则到配置文件中" tabindex="-1"><a class="header-anchor" href="#保存规则到配置文件中"><span>保存规则到配置文件中</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">cp</span> /etc/sysconfig/iptables /etc/sysconfig/iptables.bak <span class="token comment"># 任何改动之前先备份，请保持这一优秀的习惯</span>
iptables-save <span class="token operator">&gt;</span> /etc/sysconfig/iptables
<span class="token function">cat</span> /etc/sysconfig/iptables
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="列出已设置的规则" tabindex="-1"><a class="header-anchor" href="#列出已设置的规则"><span>列出已设置的规则</span></a></h4><blockquote><p>iptables -L [-t 表名] [链名]</p></blockquote><ul><li>四个表名 <code>raw</code>，<code>nat</code>，<code>filter</code>，<code>mangle</code></li><li>五个规则链名 <code>INPUT</code>、<code>OUTPUT</code>、<code>FORWARD</code>、<code>PREROUTING</code>、<code>POSTROUTING</code></li><li>filter表包含<code>INPUT</code>、<code>OUTPUT</code>、<code>FORWARD</code>三个规则链</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-L</span> <span class="token parameter variable">-t</span> nat                  <span class="token comment"># 列出 nat 上面的所有规则</span>
<span class="token comment">#            ^ -t 参数指定，必须是 raw， nat，filter，mangle 中的一个</span>
iptables <span class="token parameter variable">-L</span> <span class="token parameter variable">-t</span> nat  --line-numbers  <span class="token comment"># 规则带编号</span>
iptables <span class="token parameter variable">-L</span> INPUT

iptables <span class="token parameter variable">-L</span> <span class="token parameter variable">-nv</span>  <span class="token comment"># 查看，这个列表看起来更详细</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="清除已有规则" tabindex="-1"><a class="header-anchor" href="#清除已有规则"><span>清除已有规则</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-F</span> INPUT  <span class="token comment"># 清空指定链 INPUT 上面的所有规则</span>
iptables <span class="token parameter variable">-X</span> INPUT  <span class="token comment"># 删除指定的链，这个链必须没有被其它任何规则引用，而且这条上必须没有任何规则。</span>
                   <span class="token comment"># 如果没有指定链名，则会删除该表中所有非内置的链。</span>
iptables <span class="token parameter variable">-Z</span> INPUT  <span class="token comment"># 把指定链，或者表中的所有链上的所有计数器清零。</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="删除已添加的规则" tabindex="-1"><a class="header-anchor" href="#删除已添加的规则"><span>删除已添加的规则</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 添加一条规则</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">192.168</span>.1.5 <span class="token parameter variable">-j</span> DROP
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>将所有iptables以序号标记显示，执行：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-L</span> <span class="token parameter variable">-n</span> --line-numbers
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>比如要删除INPUT里序号为8的规则，执行：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-D</span> INPUT <span class="token number">8</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="开放指定的端口" tabindex="-1"><a class="header-anchor" href="#开放指定的端口"><span>开放指定的端口</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-d</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-j</span> ACCEPT               <span class="token comment">#允许本地回环接口(即运行本机访问本机)</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-m</span> state <span class="token parameter variable">--state</span> ESTABLISHED,RELATED <span class="token parameter variable">-j</span> ACCEPT    <span class="token comment">#允许已建立的或相关连的通行</span>
iptables <span class="token parameter variable">-A</span> OUTPUT <span class="token parameter variable">-j</span> ACCEPT         <span class="token comment">#允许所有本机向外的访问</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">22</span> <span class="token parameter variable">-j</span> ACCEPT    <span class="token comment">#允许访问22端口</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">80</span> <span class="token parameter variable">-j</span> ACCEPT    <span class="token comment">#允许访问80端口</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">21</span> <span class="token parameter variable">-j</span> ACCEPT    <span class="token comment">#允许ftp服务的21端口</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">20</span> <span class="token parameter variable">-j</span> ACCEPT    <span class="token comment">#允许FTP服务的20端口</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-j</span> reject       <span class="token comment">#禁止其他未允许的规则访问</span>
iptables <span class="token parameter variable">-A</span> FORWARD <span class="token parameter variable">-j</span> REJECT     <span class="token comment">#禁止其他未允许的规则访问</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="屏蔽ip" tabindex="-1"><a class="header-anchor" href="#屏蔽ip"><span>屏蔽IP</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">-m</span> tcp <span class="token parameter variable">-s</span> <span class="token number">192.168</span>.0.8 <span class="token parameter variable">-j</span> DROP  <span class="token comment"># 屏蔽恶意主机（比如，192.168.0.8</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">123.45</span>.6.7 <span class="token parameter variable">-j</span> DROP       <span class="token comment">#屏蔽单个IP的命令</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">123.0</span>.0.0/8 <span class="token parameter variable">-j</span> DROP      <span class="token comment">#封整个段即从123.0.0.1到123.255.255.254的命令</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">124.45</span>.0.0/16 <span class="token parameter variable">-j</span> DROP    <span class="token comment">#封IP段即从123.45.0.1到123.45.255.254的命令</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">123.45</span>.6.0/24 <span class="token parameter variable">-j</span> DROP    <span class="token comment">#封IP段即从123.45.6.1到123.45.6.254的命令是</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="指定数据包出去的网络接口" tabindex="-1"><a class="header-anchor" href="#指定数据包出去的网络接口"><span>指定数据包出去的网络接口</span></a></h4><p>只对 OUTPUT，FORWARD，POSTROUTING 三个链起作用。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-A</span> FORWARD <span class="token parameter variable">-o</span> eth0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="查看已添加的规则" tabindex="-1"><a class="header-anchor" href="#查看已添加的规则"><span>查看已添加的规则</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-L</span> <span class="token parameter variable">-n</span> <span class="token parameter variable">-v</span>
Chain INPUT <span class="token punctuation">(</span>policy DROP <span class="token number">48106</span> packets, 2690K bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination
 <span class="token number">5075</span>  589K ACCEPT     all  --  lo     *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
 191K   90M ACCEPT     tcp  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0           tcp dpt:22
1499K  133M ACCEPT     tcp  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0           tcp dpt:80
4364K 6351M ACCEPT     all  --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0           state RELATED,ESTABLISHED
 <span class="token number">6256</span>  327K ACCEPT     icmp --  *      *       <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0

Chain FORWARD <span class="token punctuation">(</span>policy ACCEPT <span class="token number">0</span> packets, <span class="token number">0</span> bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination

Chain OUTPUT <span class="token punctuation">(</span>policy ACCEPT 3382K packets, 1819M bytes<span class="token punctuation">)</span>
 pkts bytes target     prot opt <span class="token keyword">in</span>     out     <span class="token builtin class-name">source</span>               destination
 <span class="token number">5075</span>  589K ACCEPT     all  --  *      lo      <span class="token number">0.0</span>.0.0/0            <span class="token number">0.0</span>.0.0/0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="启动网络转发规则" tabindex="-1"><a class="header-anchor" href="#启动网络转发规则"><span>启动网络转发规则</span></a></h4><p>公网<code>210.14.67.7</code>让内网<code>192.168.188.0/24</code>上网</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> POSTROUTING <span class="token parameter variable">-s</span> <span class="token number">192.168</span>.188.0/24 <span class="token parameter variable">-j</span> SNAT --to-source <span class="token number">210.14</span>.67.127
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="端口映射" tabindex="-1"><a class="header-anchor" href="#端口映射"><span>端口映射</span></a></h4><p>本机的 2222 端口映射到内网 虚拟机的22 端口</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> PREROUTING <span class="token parameter variable">-d</span> <span class="token number">210.14</span>.67.127 <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">2222</span>  <span class="token parameter variable">-j</span> DNAT --to-dest <span class="token number">192.168</span>.188.115:22
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="字符串匹配" tabindex="-1"><a class="header-anchor" href="#字符串匹配"><span>字符串匹配</span></a></h4><p>比如，我们要过滤所有TCP连接中的字符串<code>test</code>，一旦出现它我们就终止这个连接，我们可以这么做：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">-m</span> string <span class="token parameter variable">--algo</span> kmp <span class="token parameter variable">--string</span> <span class="token string">&quot;test&quot;</span> <span class="token parameter variable">-j</span> REJECT --reject-with tcp-reset
iptables <span class="token parameter variable">-L</span>

<span class="token comment"># Chain INPUT (policy ACCEPT)</span>
<span class="token comment"># target     prot opt source               destination</span>
<span class="token comment"># REJECT     tcp  --  anywhere             anywhere            STRING match &quot;test&quot; ALGO name kmp TO 65535 reject-with tcp-reset</span>
<span class="token comment">#</span>
<span class="token comment"># Chain FORWARD (policy ACCEPT)</span>
<span class="token comment"># target     prot opt source               destination</span>
<span class="token comment">#</span>
<span class="token comment"># Chain OUTPUT (policy ACCEPT)</span>
<span class="token comment"># target     prot opt source               destination</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="阻止windows蠕虫的攻击" tabindex="-1"><a class="header-anchor" href="#阻止windows蠕虫的攻击"><span>阻止Windows蠕虫的攻击</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-j</span> DROP <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">-s</span> <span class="token number">0.0</span>.0.0/0 <span class="token parameter variable">-m</span> string <span class="token parameter variable">--algo</span> kmp <span class="token parameter variable">--string</span> <span class="token string">&quot;cmd.exe&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="防止syn洪水攻击" tabindex="-1"><a class="header-anchor" href="#防止syn洪水攻击"><span>防止SYN洪水攻击</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--syn</span> <span class="token parameter variable">-m</span> limit <span class="token parameter variable">--limit</span> <span class="token number">5</span>/second <span class="token parameter variable">-j</span> ACCEPT
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="添加secmark记录" tabindex="-1"><a class="header-anchor" href="#添加secmark记录"><span>添加SECMARK记录</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-t</span> mangle <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--src</span> <span class="token number">192.168</span>.1.2 <span class="token parameter variable">--dport</span> <span class="token number">443</span> <span class="token parameter variable">-j</span> SECMARK <span class="token parameter variable">--selctx</span> system_u:object_r:myauth_packet_t
<span class="token comment"># 向从 192.168.1.2:443 以TCP方式发出到本机的包添加MAC安全上下文 system_u:object_r:myauth_packet_t</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="更多实例" tabindex="-1"><a class="header-anchor" href="#更多实例"><span>更多实例</span></a></h2>`,78)),e("blockquote",null,[e("p",null,[n[150]||(n[150]=s("用iptables搭建一套强大的安全防护盾 ")),e("a",ie,[n[149]||(n[149]=s("http://www.imooc.com/learn/389")),i(a)])])]),n[157]||(n[157]=l(`<p>iptables: linux 下应用层防火墙工具</p><p>iptables 5链: 对应 Hook point netfilter: linux 操作系统核心层内部的一个数据包处理模块 Hook point: 数据包在 netfilter 中的挂载点; <code>PRE_ROUTING / INPUT / OUTPUT / FORWARD / POST_ROUTING</code></p><p>iptables &amp; netfilter <img src="http://7xq89b.com1.z0.glb.clouddn.com/netfilter&amp;iptables.jpg" alt="img" loading="lazy"></p><p>iptables 4表5链 <img src="http://7xq89b.com1.z0.glb.clouddn.com/iptables-data-stream.jpg" alt="img" loading="lazy"></p><p>iptables rules <img src="http://7xq89b.com1.z0.glb.clouddn.com/iptables-rules.jpg" alt="img" loading="lazy"></p><ul><li>4表</li></ul><p><strong>filter</strong>: 访问控制 / 规则匹配 <strong>nat</strong>: 地址转发 mangle / raw</p><ul><li>规则</li></ul><p>数据访问控制: ACCEPT / DROP / REJECT 数据包改写(nat -&gt; 地址转换): snat / dnat 信息记录: log</p><h2 id="使用场景实例" tabindex="-1"><a class="header-anchor" href="#使用场景实例"><span>使用场景实例</span></a></h2><ul><li>场景一</li></ul><p>开放 tcp 10-22/80 端口 开放 icmp 其他未被允许的端口禁止访问</p><p>存在的问题: 本机无法访问本机; 本机无法访问其他主机</p><ul><li>场景二</li></ul><p>ftp: 默认被动模式(服务器产生随机端口告诉客户端, 客户端主动连接这个端口拉取数据) vsftpd: 使 ftp 支持主动模式(客户端产生随机端口通知服务器, 服务器主动连接这个端口发送数据)</p><ul><li>场景三</li></ul><p>允许外网访问: web http -&gt; 80/tcp; https -&gt; 443/tcp mail smtp -&gt; 25/tcp; smtps -&gt; 465/tcp pop3 -&gt; 110/tcp; pop3s -&gt; 995/tcp imap -&gt; 143/tcp</p><p>内部使用: file nfs -&gt; 123/udp samba -&gt; 137/138/139/445/tcp ftp -&gt; 20/21/tcp remote ssh -&gt; 22/tcp sql mysql -&gt; 3306/tcp oracle -&gt; 1521/tcp</p><ul><li>场景四</li></ul><p>nat 转发</p><ul><li>场景五</li></ul><p>防CC攻击</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-L</span> <span class="token parameter variable">-F</span> <span class="token parameter variable">-A</span> <span class="token parameter variable">-D</span> <span class="token comment"># list flush append delete</span>
<span class="token comment"># 场景一</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">80</span> <span class="token parameter variable">-j</span> ACCEPT <span class="token comment"># 允许 tcp 80 端口</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">10</span>:22 <span class="token parameter variable">-j</span> ACCEPT <span class="token comment"># 允许 tcp 10-22 端口</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-p</span> icmp <span class="token parameter variable">-j</span> ACCEPT <span class="token comment"># 允许 icmp</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-j</span> REJECT <span class="token comment"># 添加一条规则, 不允许所有</span>

<span class="token comment"># 优化场景一</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-i</span> lo <span class="token parameter variable">-j</span> ACCEPT <span class="token comment"># 允许本机访问</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-m</span> state <span class="token parameter variable">--state</span> ESTABLISHED,RELATED <span class="token parameter variable">-j</span> ACCEPT <span class="token comment"># 允许访问外网</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">80</span> <span class="token parameter variable">-s</span> <span class="token number">10.10</span>.188.233 <span class="token parameter variable">-j</span> ACCEPT <span class="token comment"># 只允许固定ip访问80</span>

<span class="token comment"># 场景二</span>
<span class="token function">vi</span> /etc/vsftpd/vsftpd.conf <span class="token comment"># 使用 vsftpd 开启 ftp 主动模式</span>
<span class="token assign-left variable">port_enable</span><span class="token operator">=</span>yes
<span class="token assign-left variable">connect_from_port_20</span><span class="token operator">=</span>YES
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">21</span> <span class="token parameter variable">-j</span> ACCEPT

<span class="token function">vi</span> /etc/vsftpd/vsftpd.conf <span class="token comment"># 建议使用 ftp 被动模式</span>
<span class="token assign-left variable">pasv_min_port</span><span class="token operator">=</span><span class="token number">50000</span>
<span class="token assign-left variable">pasv_max_port</span><span class="token operator">=</span><span class="token number">60000</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">21</span> <span class="token parameter variable">-j</span> ACCEPT
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">50000</span>:60000 <span class="token parameter variable">-j</span> ACCEPT

<span class="token comment"># 还可以使用 iptables 模块追踪来自动开发对应的端口</span>

<span class="token comment"># 场景三</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-i</span> lo <span class="token parameter variable">-j</span> ACCEPT <span class="token comment"># 允许本机访问</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-m</span> state <span class="token parameter variable">--state</span> ESTABLISHED,RELATED <span class="token parameter variable">-j</span> ACCEPT <span class="token comment"># 允许访问外网</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">10.10</span>.155.0/24 <span class="token parameter variable">-j</span> ACCEPT <span class="token comment"># 允许内网访问</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">-m</span> multiport <span class="token parameter variable">--dports</span> <span class="token number">80,1723</span> <span class="token parameter variable">-j</span> ACCEPT <span class="token comment"># 允许端口, 80 -&gt; http, 1723 -&gt; vpn</span>
iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-j</span> REJECT <span class="token comment"># 添加一条规则, 不允许所有</span>

iptables-save <span class="token comment"># 保存设置到配置文件</span>

<span class="token comment"># 场景四</span>
iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-L</span> <span class="token comment"># 查看 nat 配置</span>

iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> POST_ROUTING <span class="token parameter variable">-s</span> <span class="token number">10.10</span>.177.0/24 <span class="token parameter variable">-j</span> SNAT <span class="token parameter variable">--to</span> <span class="token number">10.10</span>.188.232 <span class="token comment"># SNAT</span>
<span class="token function">vi</span> /etc/sysconfig/network <span class="token comment"># 配置网关</span>

iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> POST_ROUTING <span class="token parameter variable">-d</span> <span class="token number">10.10</span>.188.232 <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">80</span> <span class="token parameter variable">-j</span> DNAT <span class="token parameter variable">--to</span> <span class="token number">10.10</span>.177.232:80 <span class="token comment"># DNAT</span>

<span class="token comment">#场景五</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--syn</span> <span class="token parameter variable">--dport</span> <span class="token number">80</span> <span class="token parameter variable">-m</span> connlimit --connlimit-above <span class="token number">100</span> <span class="token parameter variable">-j</span> REJECT <span class="token comment"># 限制并发连接访问数</span>
iptables <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-m</span> limit <span class="token parameter variable">--limit</span> <span class="token number">3</span>/hour --limit-burst <span class="token number">10</span> <span class="token parameter variable">-j</span> ACCEPT <span class="token comment"># limit模块; --limit-burst 默认为5</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,23))]),n[233]||(n[233]=l(`<h2 id="编译openwrt" tabindex="-1"><a class="header-anchor" href="#编译openwrt"><span>编译OpenWrt</span></a></h2><details><summary>【查看详情】</summary><p>Lean OpenWrt编译</p><p>\\1. 不要用 root 用户进行编译</p><p>\\2. 国内用户编译前最好准备好梯子</p><p>\\3. 默认登陆IP 192.168.1.1 密码 password</p><p>编译命令</p><p>\\1. 首先装好 Linux 系统，推荐 Debian 11 或 Ubuntu LTS</p><p>\\2. 安装编译依赖</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>   sudo apt update -y
   sudo apt full-upgrade -y
   sudo apt install -y ack antlr3 asciidoc autoconf automake autopoint binutils bison build-essential \\
   bzip2 ccache cmake cpio curl device-tree-compiler fastjar flex gawk gettext gcc-multilib g++-multilib \\
   git gperf haveged help2man intltool libc6-dev-i386 libelf-dev libfuse-dev libglib2.0-dev libgmp3-dev \\
   libltdl-dev libmpc-dev libmpfr-dev libncurses5-dev libncursesw5-dev libpython3-dev libreadline-dev \\
   libssl-dev libtool lrzsz mkisofs msmtp ninja-build p7zip p7zip-full patch pkgconf python2.7 python3 \\
   python3-pyelftools python3-setuptools qemu-utils rsync scons squashfs-tools subversion swig texinfo \\
   uglifyjs upx-ucl unzip vim wget xmlto xxd zlib1g-dev
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\\3. 下载源代码，更新 feeds 并选择配置</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>   git clone https://github.com/coolsnowwolf/lede
   cd lede
   ./scripts/feeds update -a
   ./scripts/feeds install -a
   make menuconfig
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>git clone https://github.com/openwrt/openwrt        **官方版本**
git clone https://github.com/coolsnowwolf/lede       **lede版本**
git clone -b 22.03 --single-branch https://github.com/Lienol/openwrt   **lienol版本**
cd openwrt            **切换到文件目录**
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\\4. 下载 dl 库，编译固件 （-j 后面是线程数，第一次编译推荐用单线程）</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>   make download -j8
   make V=s -j1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>本套代码保证肯定可以编译成功。里面包括了 R23 所有源代码，包括 IPK 的。 你可以自由使用，但源码编译二次发布请注明我的 GitHub 仓库链接。谢谢合作！ 二次编译：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>cd lede
git pull
./scripts/feeds update -a
./scripts/feeds install -a
make defconfig
make download -j8
make V=s -j$(nproc)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果需要重新配置：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>rm -rf .config
make menuconfig
make V=s -j$(nproc)



rm -rf ./tmp &amp;&amp; rm -rf .config
make menuconfig
make V=s -j$(nproc)

编译完成后输出路径：bin/targets
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果编译失败，可以执行以下命令：</p><p>make clean 删除编译目录/bin和/build_dir目录中的文件</p><p>make dirclean 除了删除编译目录之外还删除编译工具目录，删除/bin和/build_dir目录的中的文件(make clean)以及/staging_dir、/toolchain、/tmp和/logs中的文件，一般在更换CPU架构的情况下才操作。</p><p>下载编译压缩包</p><p>编译完成后输出路径：home/用户名/openwrt/bin/targets，下载到本地电脑，需要通过SSH远程登录进行下载。ubuntu默认是没开通SSH登录，所以我们需要进行开通。</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>开通SSH登录方法：

1，必须切换成为root用户
sudo -i
2，先更新软件列表和更新软件
sudo apt-get update
3，先更新软件列表和更新软件
sudo apt-get upgrade
4，安装ssh
apt-get install ssh
5，启动ssh服务
sudo /etc/init.d/ssh start
6，检查是否有ssh环境
ps -e | grep ssh




ubuntu开通root登录SSH权限

1， 使用普通用户登录后切换root
sudo -i
2，创建root管理员密码
passwd root
3，开启root登录
sudo sed -i &#39;s/^#?PermitRootLogin./PermitRootLogin yes/g&#39; /etc/ssh/sshd_config
4，开启密码验证
sudo sed -i &#39;s/^#?PasswordAuthentication./PasswordAuthentication yes/g&#39; /etc/ssh/sshd_config
5，重启ssh服务
service sshd restart
6，检查是否有ssh环境
ps -e | grep ssh


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>安装Nginx</p><p>首先，您需要在OpenWrt上安装Nginx。可以使用以下命令在终端中进行安装：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>
opkg update
opkg install nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>安装Nginx后，您可以通过以下命令启动和停止它：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>
/etc/init.d/nginx start    # 启动Nginx
/etc/init.d/nginx stop     # 停止Nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置Nginx</p><p>接下来，您需要在OpenWrt上配置Nginx。Nginx的配置文件位于 /etc/nginx/nginx.conf 中。您可以通过修改此文件来配置Nginx。</p><p>例如，要将Nginx配置为监听端口80并向所有请求发送欢迎消息，请按照以下步骤操作：</p><ol><li>使用文本编辑器打开 /etc/nginx/nginx.conf 文件：</li></ol><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>
vi /etc/nginx/nginx.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>在 http 块中添加以下内容：</li></ol><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>worker_processes auto;

user root;

events {}

http {

upstream alist {
  server 127.0.0.1:5244;
}



server {
        listen       15244;
        server_name   localhost;
        location / {
           proxy_pass http://alist;
           proxy_set_header HOST $host;
           proxy_set_header X-Forwarded-Proto $scheme;
           proxy_set_header X-Real-IP $remote_addr;
           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
      
    }

}

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>保存并关闭文件。</li><li>重新启动Nginx以使更改生效：</li></ol><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>
/etc/init.d/nginx restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>使用Nginx模块</p><p>要在OpenWrt上使用Nginx模块，您需要将相应的模块安装到Nginx中。这些模块可以使用以下命令安装：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>
opkg update
opkg install nginx-mod-&lt;module_name&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中 &lt;module_name&gt; 是要安装的模块的名称。例如，要安装HttpEchoModule，可以使用以下命令：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>
opkg update
opkg install nginx-mod-http-echo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>安装完毕后，您需要修改 /etc/nginx/nginx.conf 文件</p></details><h2 id="x-ui-docker-image" tabindex="-1"><a class="header-anchor" href="#x-ui-docker-image"><span>x-ui docker image</span></a></h2>`,3)),e("details",null,[n[200]||(n[200]=e("summary",null,"【查看详情】",-1)),n[201]||(n[201]=e("h1",{id:"x-ui-docker-image-1",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#x-ui-docker-image-1"},[e("span",null,"x-ui docker image")])],-1)),e("p",null,[e("a",le,[n[158]||(n[158]=e("img",{src:"https://camo.githubusercontent.com/d96851e7ecb70b37627c8ee4c37ace32b44849b96cfd3c21d165ee195b16c80c/68747470733a2f2f696d672e736869656c64732e696f2f646f636b65722f70756c6c732f656e77616961782f782d75692e7376673f7374796c653d666c61742d737175617265",alt:"Docker Pulls",loading:"lazy"},null,-1)),i(a)]),n[164]||(n[164]=s()),e("a",te,[n[159]||(n[159]=e("img",{src:"https://camo.githubusercontent.com/34db02d30a62844e8ddd0a7a66be59f3cf0cf4e9e214798ca3af61be5dbef25e/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f636f6e7472696275746f72732f63686173696e6736362f782d75692e7376673f7374796c653d666c61742d737175617265",alt:"Contributors",loading:"lazy"},null,-1)),i(a)]),n[165]||(n[165]=s()),e("a",re,[n[160]||(n[160]=e("img",{src:"https://camo.githubusercontent.com/fca4b77a86a23f5579544684557354e2faae40118e31e6bb939d46de40f707e2/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f666f726b732f63686173696e6736362f782d75692e7376673f7374796c653d666c61742d737175617265",alt:"Forks",loading:"lazy"},null,-1)),i(a)]),n[166]||(n[166]=s()),e("a",de,[n[161]||(n[161]=e("img",{src:"https://camo.githubusercontent.com/95b070f9bfcd5913c3f0e934820f4e70db4da2dedc77ce793bc7d492b59b1907/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f73746172732f63686173696e6736362f782d75692e7376673f7374796c653d666c61742d737175617265",alt:"Stargazers",loading:"lazy"},null,-1)),i(a)]),n[167]||(n[167]=s()),e("a",oe,[n[162]||(n[162]=e("img",{src:"https://camo.githubusercontent.com/53896d0afa3d78e3eb73548ba7453d36b786254823e2a2a87d21fb8df5c2e224/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6973737565732f63686173696e6736362f782d75692e7376673f7374796c653d666c61742d737175617265",alt:"Issues",loading:"lazy"},null,-1)),i(a)]),n[168]||(n[168]=s()),e("a",pe,[n[163]||(n[163]=e("img",{src:"https://camo.githubusercontent.com/eaa9f26d39a11e4c60209a4d9de91a64470a37c667e17ea2662b43de08495f5c/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6963656e73652f43686173696e6736362f782d75692e7376673f7374796c653d666c61742d737175617265",alt:"MIT License",loading:"lazy"},null,-1)),i(a)])]),n[202]||(n[202]=e("blockquote",null,[e("p",null,"x-ui docker 版本")],-1)),n[203]||(n[203]=e("p",null,[s("可以通过使用不同的"),e("code",null,"tag"),s("来使用不同作者的镜像")],-1)),e("p",null,[n[172]||(n[172]=s("Tagamd64arm64armv7s390x")),e("a",ce,[n[169]||(n[169]=s("vaxilu/x-ui")),i(a)]),n[173]||(n[173]=s("latest✅✅✅✅")),e("a",ve,[n[170]||(n[170]=s("FranzKafkaYu/x-ui")),i(a)]),n[174]||(n[174]=s("alpha-zh✅✅❌✅")),e("a",ue,[n[171]||(n[171]=s("X-UI-Unofficial/x-ui")),i(a)]),n[175]||(n[175]=s("beta✅✅❌✅"))]),n[204]||(n[204]=l(`<h3 id="为什么要使用docker" tabindex="-1"><a class="header-anchor" href="#为什么要使用docker"><span>为什么要使用<code>docker</code></span></a></h3><ul><li>一致性且能保证环境隔离</li><li>快速部署</li><li>保证灵活性和扩展性</li><li>更好的可移植性</li><li>低成本</li><li>方便控制版本</li><li>安全</li><li>.....</li></ul><h3 id="对于-x-ui-如果使用-docker" tabindex="-1"><a class="header-anchor" href="#对于-x-ui-如果使用-docker"><span>对于 x-ui，如果使用 docker</span></a></h3><ul><li>无需关心原宿主机的系统，架构，版本</li><li>不会破坏原系统，如果不想使用，很方便就能完全干净的卸载</li><li>部署方便且容易升级</li></ul><h3 id="如何使用" tabindex="-1"><a class="header-anchor" href="#如何使用"><span>如何使用</span></a></h3><h4 id="前提-安装好-docker" tabindex="-1"><a class="header-anchor" href="#前提-安装好-docker"><span>前提：安装好 docker</span></a></h4><p>使用官方一键脚本</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>curl -sSL https://get.docker.com/ | sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="运行你的容器" tabindex="-1"><a class="header-anchor" href="#运行你的容器"><span>运行你的容器</span></a></h4>`,9)),e("h5",me,[e("a",be,[e("span",null,[n[177]||(n[177]=s("使用 ")),e("a",ge,[n[176]||(n[176]=s("vaxilu/x-ui")),i(a)]),n[178]||(n[178]=s(" 版本的"))])])]),n[205]||(n[205]=l(`<div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>mkdir x-ui &amp;&amp; cd x-ui
docker run -itd --network=host \\
    -v $PWD/db/:/etc/x-ui/ \\
    -v $PWD/cert/:/root/cert/ \\
    --name x-ui --restart=unless-stopped \\
    enwaiax/x-ui
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1)),e("p",null,[n[180]||(n[180]=s("注意: 如果希望使用")),e("a",ke,[n[179]||(n[179]=s("FranzKafkaYu/x-ui")),i(a)]),n[181]||(n[181]=s("版本，仅需要讲上述镜像修改为 ")),n[182]||(n[182]=e("code",null,"enwaiax/x-ui:alpha-zh",-1))]),n[206]||(n[206]=l(`<h5 id="使用-docker-compose-运行" tabindex="-1"><a class="header-anchor" href="#使用-docker-compose-运行"><span>使用 docker-compose 运行</span></a></h5><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>mkdir x-ui &amp;&amp; cd x-ui
wget https://raw.githubusercontent.com//chasing66/x-ui/main/docker-compose.yml
docker compose up -d
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="如何启用-ssl" tabindex="-1"><a class="header-anchor" href="#如何启用-ssl"><span>如何启用 ssl</span></a></h4><ul><li>假设你的 x-ui 端口是 <code>54321</code></li><li>假设你的 IP 是 <code>10.10.10.10</code></li><li>假设你的域名是 <code>xui.example.com</code>，且已经做好 A 记录解析</li><li>假设你使用的是 Debian 10+或者 Ubuntu 18+的系统</li><li>假设你的邮箱是 <code>xxxx@example.com</code></li></ul><h5 id="步骤如下" tabindex="-1"><a class="header-anchor" href="#步骤如下"><span>步骤如下</span></a></h5><ol><li>安装必要软件</li></ol><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>sudo apt update
sudo apt install snapd nginx
sudo snap install core
sudo snap refresh core
sudo snap install --classic certbot
sudo ln -s /snap/bin/certbot /usr/bin/certbot
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>新建一个 nginx 配置</li></ol><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>touch /etc/nginx/conf.d/xui.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>增加以下配置，按照实际情况调整</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>server {
    listen 80;
    listen [::]:80;
    server_name xui.example.com;

    location / {
        proxy_redirect off;
        proxy_pass http://127.0.0.1:54321;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
    }

    # 反代websocket
     location /xray {
         proxy_redirect off;
         proxy_pass http://127.0.0.1:10001;
         proxy_http_version 1.1;
         proxy_set_header Upgrade $http_upgrade;
         proxy_set_header Connection &quot;upgrade&quot;;
         proxy_set_header X-Real-IP $remote_addr;
         proxy_set_header Host $http_host;
         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
         proxy_set_header Y-Real-IP $realip_remote_addr;
     }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>检查配置是否正常</li></ol><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>nginx -t
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol><li>申请证书，按照提示设置</li></ol><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>certbot --nginx --agree-tos --no-eff-email --email xxxxx@example.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,15)),e("p",null,[n[184]||(n[184]=s("更多细节可以参考 ")),e("a",he,[n[183]||(n[183]=s("cerbot")),i(a)])]),n[207]||(n[207]=l(`<ol><li>刷新 nginx 配置生效</li></ol><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>ngins -s reload
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol><li>配置定时任务</li></ol><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>sudo certbot renew --dry-run
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_3x-ui" tabindex="-1"><a class="header-anchor" href="#_3x-ui"><span>3X-UI</span></a></h3>`,5)),e("p",null,[e("a",xe,[n[185]||(n[185]=s("English⁠")),i(a)]),n[188]||(n[188]=s(" | ")),e("a",fe,[n[186]||(n[186]=s("Español⁠")),i(a)]),n[189]||(n[189]=s(" | ")),e("a",Ee,[n[187]||(n[187]=s("Русский⁠")),i(a)])]),n[208]||(n[208]=e("p",null,[e("strong",null,"一个更好的面板 • 基于Xray Core构建")],-1)),e("p",null,[e("a",ye,[n[190]||(n[190]=e("img",{src:"https://img.shields.io/github/v/release/aircross/3x-ui.svg",alt:"img",loading:"lazy"},null,-1)),i(a)]),e("a",Ae,[n[191]||(n[191]=e("img",{src:"https://img.shields.io/github/actions/workflow/status/aircross/3x-ui/release.yml.svg",alt:"img",loading:"lazy"},null,-1)),i(a)]),e("a",_e,[n[192]||(n[192]=e("img",{src:"https://img.shields.io/github/go-mod/go-version/aircross/3x-ui.svg",alt:"GO Version",loading:"lazy"},null,-1)),i(a)]),e("a",Te,[n[193]||(n[193]=e("img",{src:"https://img.shields.io/docker/pulls/aircross/3x-ui.svg?style=flat-square",alt:"Docker Pulls",loading:"lazy"},null,-1)),i(a)]),e("a",Pe,[n[194]||(n[194]=e("img",{src:"https://img.shields.io/badge/license-GPL V3-blue.svg?longCache=true",alt:"License",loading:"lazy"},null,-1)),i(a)])]),n[209]||(n[209]=l('<blockquote><p><strong>Disclaimer:</strong> 此项目仅供个人学习交流，请不要用于非法目的，请不要在生产环境中使用。</p></blockquote><p><strong>如果此项目对你有用，请给一个</strong>🌟</p><h4 id="默认信息" tabindex="-1"><a class="header-anchor" href="#默认信息"><span>默认信息</span></a></h4><p>访问端口：2053</p><p>用户名/密码：admin</p><h4 id="x-ui" tabindex="-1"><a class="header-anchor" href="#x-ui"><span>X-UI</span></a></h4>',6)),e("p",null,[n[197]||(n[197]=s("如果你需要使用X-UI，可以点击这里访问：")),e("a",Ie,[n[195]||(n[195]=s("aircross/x-ui⁠")),i(a)]),n[198]||(n[198]=e("br",null,null,-1)),e("a",Re,[n[196]||(n[196]=e("img",{src:"https://img.shields.io/docker/pulls/aircross/x-ui.svg?style=flat-square",alt:"Docker Pulls",loading:"lazy"},null,-1)),i(a)])]),n[210]||(n[210]=l(`<h4 id="安装-升级" tabindex="-1"><a class="header-anchor" href="#安装-升级"><span>安装 &amp; 升级</span></a></h4><h4 id="通过docker安装" tabindex="-1"><a class="header-anchor" href="#通过docker安装"><span>通过Docker安装</span></a></h4><p><strong>使用</strong></p><ol><li>安装Docker：</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment">#国外服务器使用以下命令安装Docker</span>
<span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://get.docker.com <span class="token operator">|</span> <span class="token function">sh</span>
<span class="token comment"># 设置开机自启</span>
<span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> docker.service
<span class="token comment"># 根据实际需要保留参数start|restart|stop</span>
<span class="token function">sudo</span> <span class="token function">service</span> <span class="token function">docker</span> start<span class="token operator">|</span>restart<span class="token operator">|</span>stop
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>国内的请参照下面这个教程安装，需要配合能访问download.docker.com的服务器服用</p>`,6)),e("p",null,[e("strong",null,[e("a",we,[n[199]||(n[199]=s("和谐之后如何在国内安装Docker及拉取镜像使用⁠⁠")),i(a)])])]),n[211]||(n[211]=l(`<ol><li><p>docker compose安装，克隆仓库：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">git</span> clone https://github.com/aircross/3x-ui.git
<span class="token builtin class-name">cd</span> 3x-ui
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>运行服务：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">docker</span> compose up <span class="token parameter variable">-d</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol><li><p>docker一键安装：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /opt/docker/3x-ui/
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /opt/docker/acme.sh/
<span class="token function">docker</span> run <span class="token parameter variable">-itd</span> <span class="token punctuation">\\</span>
   <span class="token parameter variable">-e</span> <span class="token assign-left variable">XRAY_VMESS_AEAD_FORCED</span><span class="token operator">=</span>false <span class="token punctuation">\\</span>
   <span class="token parameter variable">-v</span> /opt/docker/3x-ui/:/etc/x-ui/ <span class="token punctuation">\\</span>
   <span class="token parameter variable">-v</span> /opt/docker/acme.sh/:/root/cert/ <span class="token punctuation">\\</span>
   <span class="token parameter variable">--network</span><span class="token operator">=</span>host <span class="token punctuation">\\</span>
   <span class="token parameter variable">--restart</span><span class="token operator">=</span>unless-stopped <span class="token punctuation">\\</span>
   <span class="token parameter variable">--name</span> 3x-ui <span class="token punctuation">\\</span>
   aircross/3x-ui:latest
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h5 id="如果你需要安装acme-sh用户管理ssl证书的docker-可以执行一下命令" tabindex="-1"><a class="header-anchor" href="#如果你需要安装acme-sh用户管理ssl证书的docker-可以执行一下命令"><span>如果你需要安装ACME.SH用户管理SSL证书的Docker，可以执行一下命令</span></a></h5><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /opt/docker/acme.sh
<span class="token function">docker</span> run <span class="token parameter variable">-itd</span> <span class="token parameter variable">-v</span> /opt/docker/acme.sh:/acme.sh <span class="token parameter variable">--net</span><span class="token operator">=</span>host <span class="token parameter variable">--restart</span><span class="token operator">=</span>unless-stopped <span class="token parameter variable">--name</span><span class="token operator">=</span>acme.sh <span class="token parameter variable">-v</span> /var/run/docker.sock:/var/run/docker.sock neilpang/acme.sh daemon
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token punctuation">\\</span>
    <span class="token parameter variable">-e</span> <span class="token assign-left variable">CF_Email</span><span class="token operator">=</span>你的CF邮箱 <span class="token punctuation">\\</span>
    <span class="token parameter variable">-e</span> <span class="token assign-left variable">CF_Key</span><span class="token operator">=</span>你的CF API Key  <span class="token punctuation">\\</span>
    acme.sh <span class="token parameter variable">--issue</span> <span class="token parameter variable">-d</span> demo.com  <span class="token parameter variable">--dns</span> dns_cf  <span class="token punctuation">\\</span>
    <span class="token parameter variable">--server</span> letsencrypt
<span class="token comment">#默认使用letsencrypt作废证书签发服务</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>x-ui的Docker执行命令添加下面这一行</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>    <span class="token parameter variable">-v</span> /opt/docker/acme.sh:/acme.sh/ <span class="token punctuation">\\</span>
    <span class="token comment">#在x-ui的docker里面域名证书的路径为/acme.sh/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>更新至最新版本</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code> <span class="token builtin class-name">cd</span> 3x-ui
 <span class="token function">docker</span> compose down
 <span class="token function">docker</span> compose pull 3x-ui
 <span class="token function">docker</span> compose up <span class="token parameter variable">-d</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从Docker中删除3x-ui</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code> <span class="token function">docker</span> stop 3x-ui
 <span class="token function">docker</span> <span class="token function">rm</span> 3x-ui
 <span class="token builtin class-name">cd</span> --
 <span class="token function">rm</span> <span class="token parameter variable">-r</span> 3x-ui
<span class="token function">bash</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token function">curl</span> <span class="token parameter variable">-Ls</span> https://raw.githubusercontent.com/aircross/3x-ui/master/install.sh<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="install-custom-version" tabindex="-1"><a class="header-anchor" href="#install-custom-version"><span>Install Custom Version</span></a></h4><p>To install your desired version, add the version to the end of the installation command. e.g., ver <code>v2.4.2</code>:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">bash</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token function">curl</span> <span class="token parameter variable">-Ls</span> https://raw.githubusercontent.com/mhsanaei/3x-ui/master/install.sh<span class="token punctuation">)</span> v2.4.2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,15))]),n[234]||(n[234]=e("h2",{id:"零基础保姆级小白节点搭建教学-目前最安全最稳定的搭建方式-通过x-ui面板实现单端口多用户合租",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#零基础保姆级小白节点搭建教学-目前最安全最稳定的搭建方式-通过x-ui面板实现单端口多用户合租"},[e("span",null,"零基础保姆级小白节点搭建教学，目前最安全最稳定的搭建方式，通过x-ui面板实现单端口多用户合租")])],-1)),e("details",null,[n[218]||(n[218]=e("summary",null,"【查看详情】",-1)),n[219]||(n[219]=e("h3",{id:"vps购买",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#vps购买"},[e("span",null,"VPS购买")])],-1)),e("p",null,[n[213]||(n[213]=s("搬瓦工：")),e("a",qe,[n[212]||(n[212]=s("https://bwg.bulianglin.com")),i(a)])]),n[220]||(n[220]=e("p",null,[s("优惠码： "),e("strong",null,"BWHCGLUKKB")],-1)),n[221]||(n[221]=e("blockquote",null,[e("p",null,"执行unminimize之后，中途如果出现如下图的A new version提示信息，输入数字2，再回车即可")],-1)),n[222]||(n[222]=e("figure",null,[e("img",{src:"https://telegra.ph/file/8785b3996bd9aae003a67.png",alt:"img",tabindex:"0",loading:"lazy"}),e("figcaption",null,"img")],-1)),n[223]||(n[223]=e("p",null,"输入数字2，再回车",-1)),n[224]||(n[224]=e("h3",{id:"域名购买",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#域名购买"},[e("span",null,"域名购买")])],-1)),e("p",null,[n[215]||(n[215]=s("namesilo：")),e("a",Ce,[n[214]||(n[214]=s("https://name.bulianglin.com")),i(a)])]),n[225]||(n[225]=e("p",null,"优惠码：oldtong",-1)),n[226]||(n[226]=e("h3",{id:"ssh工具",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#ssh工具"},[e("span",null,"SSH工具")])],-1)),e("p",null,[n[217]||(n[217]=s("FinalShell：")),e("a",Oe,[n[216]||(n[216]=s("https://www.hostbuf.com/t/988.html")),i(a)])]),n[227]||(n[227]=l(`<h3 id="节点搭建" tabindex="-1"><a class="header-anchor" href="#节点搭建"><span>节点搭建</span></a></h3><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>#更新软件源
apt update
#启用 BBR TCP 拥塞控制算法
echo &quot;net.core.default_qdisc=fq&quot; &gt;&gt; /etc/sysctl.conf
echo &quot;net.ipv4.tcp_congestion_control=bbr&quot; &gt;&gt; /etc/sysctl.conf
sysctl -p

#安装x-ui：
bash &lt;(curl -Ls https://raw.githubusercontent.com/vaxilu/x-ui/master/install.sh)

#安装nginx
apt install nginx
#安装acme：
curl https://get.acme.sh | sh
#添加软链接：
ln -s  /root/.acme.sh/acme.sh /usr/local/bin/acme.sh
#切换CA机构： 
acme.sh --set-default-ca --server letsencrypt
#申请证书： 
acme.sh  --issue -d 你的域名 -k ec-256 --webroot  /var/www/html
#安装证书：
acme.sh --install-cert -d 你的域名 --ecc --key-file /etc/x-ui/server.key  --fullchain-file /etc/x-ui/server.crt --reloadcmd &quot;systemctl force-reload nginx&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="寻找适合的伪装站" tabindex="-1"><a class="header-anchor" href="#寻找适合的伪装站"><span>寻找适合的伪装站</span></a></h3><blockquote><p>http站点优先，个人网盘符合单节点大流量特征</p></blockquote><p>示例关键字：intext:登录 Cloudreve</p><h3 id="配置nginx" tabindex="-1"><a class="header-anchor" href="#配置nginx"><span>配置nginx</span></a></h3><p>配置文件路径：/etc/nginx/nginx.conf</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>user www-data;
worker_processes auto;
pid /run/nginx.pid;
include /etc/nginx/modules-enabled/*.conf;

events {
    worker_connections 1024;
}

http {
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;

    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    gzip on;

    server {
        listen 443 ssl;
        
        server_name nicename.co;  #你的域名
        ssl_certificate       /etc/x-ui/server.crt;  #证书位置
        ssl_certificate_key   /etc/x-ui/server.key; #私钥位置
        
        ssl_session_timeout 1d;
        ssl_session_cache shared:MozSSL:10m;
        ssl_session_tickets off;
        ssl_protocols    TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers off;

        location / {
            proxy_pass https://bing.com; #伪装网址
            proxy_redirect off;
            proxy_ssl_server_name on;
            sub_filter_once off;
            sub_filter &quot;bing.com&quot; $server_name;
            proxy_set_header Host &quot;bing.com&quot;;
            proxy_set_header Referer $http_referer;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header User-Agent $http_user_agent;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto https;
            proxy_set_header Accept-Encoding &quot;&quot;;
            proxy_set_header Accept-Language &quot;zh-CN&quot;;
        }


        location /ray {   #分流路径
            proxy_redirect off;
            proxy_pass http://127.0.0.1:10000; #Xray端口
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection &quot;upgrade&quot;;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
        
        location /xui {   #xui路径
            proxy_redirect off;
            proxy_pass http://127.0.0.1:9999;  #xui监听端口
            proxy_http_version 1.1;
            proxy_set_header Host $host;
        }
    }

    server {
        listen 80;
        location /.well-known/ {
               root /var/www/html;
            }
        location / {
                rewrite ^(.*)$ https://$host$1 permanent;
            }
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>每次修改nginx配置文件后必须使用 systemctl reload nginx 命令重新加载配置文件</p></blockquote><h3 id="多用户合租" tabindex="-1"><a class="header-anchor" href="#多用户合租"><span>多用户合租</span></a></h3><blockquote><p>通过修改nginx的配置文件实现ws path路径分流</p></blockquote><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>location /ray {   #分流路径
    proxy_redirect off;
    proxy_pass http://127.0.0.1:10000; #Xray端口
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection &quot;upgrade&quot;;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,12))]),n[235]||(n[235]=l(`<h2 id="docker离线镜像" tabindex="-1"><a class="header-anchor" href="#docker离线镜像"><span>docker离线镜像</span></a></h2><details><summary>【查看详情】</summary><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>name: Alist_docker_amd64
on:
  workflow_dispatch:
    inputs:
      docker_images:
        description: &#39;请填写docker镜像名称 多个用英文逗号分开&#39;
        required: true
        default: &#39;xhofe/alist:latest&#39;  # 设置默认的 Docker 镜像列表

jobs:
  pull_and_package:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Clean up Docker to free space
      run: |
          docker system prune -a -f
          docker volume prune -f

    - name: Pull Docker Images and Package
      run: |
        images=&quot;\${{ github.event.inputs.docker_images }}&quot;
        IFS=&#39;,&#39; read -r -a image_array &lt;&lt;&lt; &quot;$images&quot;
        for image in &quot;\${image_array[@]}&quot;; do
          docker pull &quot;\${image}&quot; --platform &quot;linux/amd64&quot;
          docker save &quot;\${image}&quot; -o &quot;$(echo &quot;\${image}&quot; | sed &#39;s/[\\/:]/-/g&#39;)-amd64.tar&quot;
        done

    - name: Generate MD5 checksums
      run: |
          for file in *.tar; do
            md5sum &quot;$file&quot; &gt;&gt; &quot;\${file}.md5&quot;
          done 
          
    - name: Get filenames in current directory
      run: |
       echo &quot;FILENAMES=$(ls *.tar 2&gt;/dev/null | tr &#39;\\n&#39; &#39; &#39; | sed &#39;s/ $//&#39;)&quot; &gt;&gt; $GITHUB_ENV    
   
    - name: Compress each TAR file separately
      run: |
        for file in *.tar; do
          tar -czf &quot;\${file}.gz&quot; &quot;$file&quot; &quot;\${file}.md5&quot;
        done
      
    - name: Set Release Date
      id: set_date
      run: echo &quot;RELEASE_DATE=$(date +&#39;%Y-%m-%d&#39;)&quot; &gt;&gt; $GITHUB_ENV



    - name: Prepare MD5 content
      id: prepare_md5
      run: |
          echo &quot;MD5_CONTENTS&lt;&lt;EOF&quot; &gt;&gt; $GITHUB_ENV
          cat *-amd64.tar.md5 &gt;&gt; $GITHUB_ENV
          echo &quot;EOF&quot; &gt;&gt; $GITHUB_ENV
    
    - name: Upload artifacts
      uses: actions/upload-artifact@v4
      with:
        name: dockerimages
        path: &#39;*.gz&#39;
        retention-days: 1  # 将保留天数设置为 1 天
    - name: Create release
      id: create_release
      uses: ncipollo/release-action@v1
      with:
        tag: &quot;release-\${{ env.RELEASE_DATE }}-\${{ github.run_id }}&quot;
        name: &quot;\${{ env.RELEASE_DATE }}: \${{ env.FILENAMES }}&quot;
        body: \${{ env.MD5_CONTENTS }}
        artifacts: |
                   *.tar
                   *.md5
                   *.gz
                

    - name: Clean up intermediate files
      run: |
        rm *-amd64.tar

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details>`,2))])}const Ne=t(p,[["render",De],["__file","其他.html.vue"]]),$e=JSON.parse('{"path":"/other/%E8%BD%AF%E8%B7%AF%E7%94%B1/OpenWrt/%E5%85%B6%E4%BB%96.html","title":"其他","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"docker导出镜像","slug":"docker导出镜像","link":"#docker导出镜像","children":[]},{"level":2,"title":"Git提交代码","slug":"git提交代码","link":"#git提交代码","children":[]},{"level":2,"title":"配置alist反向代理","slug":"配置alist反向代理","link":"#配置alist反向代理","children":[]},{"level":2,"title":"通过公钥进行ssh连接","slug":"通过公钥进行ssh连接","link":"#通过公钥进行ssh连接","children":[]},{"level":2,"title":"1 生成密钥","slug":"_1-生成密钥","link":"#_1-生成密钥","children":[{"level":3,"title":"1.1 法一：在设备生成密钥[不推荐]","slug":"_1-1-法一-在设备生成密钥-不推荐","link":"#_1-1-法一-在设备生成密钥-不推荐","children":[]},{"level":3,"title":"1.2 法二：在本地生成密钥","slug":"_1-2-法二-在本地生成密钥","link":"#_1-2-法二-在本地生成密钥","children":[]}]},{"level":2,"title":"2 关闭ssh的账号密码登陆","slug":"_2-关闭ssh的账号密码登陆","link":"#_2-关闭ssh的账号密码登陆","children":[]},{"level":2,"title":"Docker","slug":"docker","link":"#docker","children":[{"level":3,"title":"启动Docker","slug":"启动docker","link":"#启动docker","children":[]}]},{"level":2,"title":"compose","slug":"compose","link":"#compose","children":[{"level":4,"title":"CentOS 7.x 修改固定IP地址","slug":"centos-7-x-修改固定ip地址","link":"#centos-7-x-修改固定ip地址","children":[]}]},{"level":2,"title":"Alist","slug":"alist","link":"#alist","children":[]},{"level":2,"title":"自定义路径","slug":"自定义路径","link":"#自定义路径","children":[]},{"level":2,"title":"#获取密码","slug":"获取密码","link":"#获取密码","children":[{"level":4,"title":"#低于v3.25.0版本","slug":"低于v3-25-0版本","link":"#低于v3-25-0版本","children":[]},{"level":4,"title":"#高于v3.25.0版本","slug":"高于v3-25-0版本","link":"#高于v3-25-0版本","children":[]}]},{"level":2,"title":"获取 AList","slug":"获取-alist","link":"#获取-alist","children":[]},{"level":2,"title":"#手动运行","slug":"手动运行","link":"#手动运行","children":[]},{"level":2,"title":"#守护进程","slug":"守护进程","link":"#守护进程","children":[]},{"level":2,"title":"#如何更新","slug":"如何更新","link":"#如何更新","children":[]},{"level":2,"title":"#获取密码","slug":"获取密码-1","link":"#获取密码-1","children":[{"level":4,"title":"#低于v3.25.0版本","slug":"低于v3-25-0版本-1","link":"#低于v3-25-0版本-1","children":[]},{"level":4,"title":"#高于v3.25.0版本","slug":"高于v3-25-0版本-1","link":"#高于v3-25-0版本-1","children":[]},{"level":4,"title":"低于v3.25.0版本","slug":"低于v3-25-0版本-2","link":"#低于v3-25-0版本-2","children":[]},{"level":4,"title":"#高于v3.25.0版本","slug":"高于v3-25-0版本-2","link":"#高于v3-25-0版本-2","children":[]}]},{"level":2,"title":"#发行版本","slug":"发行版本","link":"#发行版本","children":[{"level":5,"title":"#docker-cli","slug":"docker-cli","link":"#docker-cli","children":[]},{"level":5,"title":"#docker-compose","slug":"docker-compose","link":"#docker-compose","children":[]},{"level":3,"title":"#使用 aria2 离线下载","slug":"使用-aria2-离线下载","link":"#使用-aria2-离线下载","children":[]},{"level":3,"title":"#开发版本","slug":"开发版本","link":"#开发版本","children":[{"level":5,"title":"#docker-cli","slug":"docker-cli-1","link":"#docker-cli-1","children":[]},{"level":5,"title":"#docker-compose","slug":"docker-compose-1","link":"#docker-compose-1","children":[]}]},{"level":3,"title":"用户/组标识符","slug":"用户-组标识符","link":"#用户-组标识符","children":[]},{"level":3,"title":"#手动编译 Docker 镜像","slug":"手动编译-docker-镜像","link":"#手动编译-docker-镜像","children":[]}]},{"level":2,"title":"环境准备","slug":"环境准备","link":"#环境准备","children":[]},{"level":2,"title":"#构建前端","slug":"构建前端","link":"#构建前端","children":[]},{"level":2,"title":"#构建后端","slug":"构建后端","link":"#构建后端","children":[]},{"level":2,"title":"nginx","slug":"nginx","link":"#nginx","children":[{"level":3,"title":"如何对子目录进行反向代理？","slug":"如何对子目录进行反向代理","link":"#如何对子目录进行反向代理","children":[]},{"level":3,"title":"自动渐变背景","slug":"自动渐变背景","link":"#自动渐变背景","children":[]}]},{"level":2,"title":"Nginx","slug":"nginx-1","link":"#nginx-1","children":[{"level":5,"title":"安装所需环境","slug":"安装所需环境","link":"#安装所需环境","children":[]},{"level":5,"title":"一、gcc安装","slug":"一、gcc安装","link":"#一、gcc安装","children":[]},{"level":5,"title":"二、pcre pcre-devel 安装","slug":"二、pcre-pcre-devel-安装","link":"#二、pcre-pcre-devel-安装","children":[]},{"level":5,"title":"三、 zlib安装","slug":"三、-zlib安装","link":"#三、-zlib安装","children":[]},{"level":5,"title":"四、openssl安装","slug":"四、openssl安装","link":"#四、openssl安装","children":[]},{"level":5,"title":"五、下载Nginx","slug":"五、下载nginx","link":"#五、下载nginx","children":[]},{"level":5,"title":"六、开机自启动","slug":"六、开机自启动","link":"#六、开机自启动","children":[]},{"level":4,"title":"nginx systemctl启动配置","slug":"nginx-systemctl启动配置","link":"#nginx-systemctl启动配置","children":[]},{"level":4,"title":"卸载 nginx","slug":"卸载-nginx","link":"#卸载-nginx","children":[]}]},{"level":2,"title":"OpenWrt扩容overlay","slug":"openwrt扩容overlay","link":"#openwrt扩容overlay","children":[]},{"level":2,"title":"iptables","slug":"iptables","link":"#iptables","children":[]},{"level":2,"title":"补充说明","slug":"补充说明","link":"#补充说明","children":[{"level":3,"title":"语法","slug":"语法","link":"#语法","children":[]},{"level":3,"title":"选项","slug":"选项","link":"#选项","children":[]}]},{"level":2,"title":"基本参数","slug":"基本参数","link":"#基本参数","children":[{"level":4,"title":"命令选项输入顺序","slug":"命令选项输入顺序","link":"#命令选项输入顺序","children":[]},{"level":4,"title":"工作机制","slug":"工作机制","link":"#工作机制","children":[]},{"level":4,"title":"防火墙的策略","slug":"防火墙的策略","link":"#防火墙的策略","children":[]},{"level":3,"title":"实例","slug":"实例","link":"#实例","children":[{"level":4,"title":"清空当前的所有规则和计数","slug":"清空当前的所有规则和计数","link":"#清空当前的所有规则和计数","children":[]},{"level":4,"title":"配置允许ssh端口连接","slug":"配置允许ssh端口连接","link":"#配置允许ssh端口连接","children":[]},{"level":4,"title":"允许本地回环地址可以正常使用","slug":"允许本地回环地址可以正常使用","link":"#允许本地回环地址可以正常使用","children":[]},{"level":4,"title":"设置默认的规则","slug":"设置默认的规则","link":"#设置默认的规则","children":[]},{"level":4,"title":"配置白名单","slug":"配置白名单","link":"#配置白名单","children":[]},{"level":4,"title":"开启相应的服务端口","slug":"开启相应的服务端口","link":"#开启相应的服务端口","children":[]},{"level":4,"title":"保存规则到配置文件中","slug":"保存规则到配置文件中","link":"#保存规则到配置文件中","children":[]},{"level":4,"title":"列出已设置的规则","slug":"列出已设置的规则","link":"#列出已设置的规则","children":[]},{"level":4,"title":"清除已有规则","slug":"清除已有规则","link":"#清除已有规则","children":[]},{"level":4,"title":"删除已添加的规则","slug":"删除已添加的规则","link":"#删除已添加的规则","children":[]},{"level":4,"title":"开放指定的端口","slug":"开放指定的端口","link":"#开放指定的端口","children":[]},{"level":4,"title":"屏蔽IP","slug":"屏蔽ip","link":"#屏蔽ip","children":[]},{"level":4,"title":"指定数据包出去的网络接口","slug":"指定数据包出去的网络接口","link":"#指定数据包出去的网络接口","children":[]},{"level":4,"title":"查看已添加的规则","slug":"查看已添加的规则","link":"#查看已添加的规则","children":[]},{"level":4,"title":"启动网络转发规则","slug":"启动网络转发规则","link":"#启动网络转发规则","children":[]},{"level":4,"title":"端口映射","slug":"端口映射","link":"#端口映射","children":[]},{"level":4,"title":"字符串匹配","slug":"字符串匹配","link":"#字符串匹配","children":[]},{"level":4,"title":"阻止Windows蠕虫的攻击","slug":"阻止windows蠕虫的攻击","link":"#阻止windows蠕虫的攻击","children":[]},{"level":4,"title":"防止SYN洪水攻击","slug":"防止syn洪水攻击","link":"#防止syn洪水攻击","children":[]},{"level":4,"title":"添加SECMARK记录","slug":"添加secmark记录","link":"#添加secmark记录","children":[]}]}]},{"level":2,"title":"更多实例","slug":"更多实例","link":"#更多实例","children":[]},{"level":2,"title":"使用场景实例","slug":"使用场景实例","link":"#使用场景实例","children":[]},{"level":2,"title":"编译OpenWrt","slug":"编译openwrt","link":"#编译openwrt","children":[]},{"level":2,"title":"x-ui docker image","slug":"x-ui-docker-image","link":"#x-ui-docker-image","children":[{"level":3,"title":"为什么要使用docker","slug":"为什么要使用docker","link":"#为什么要使用docker","children":[]},{"level":3,"title":"对于 x-ui，如果使用 docker","slug":"对于-x-ui-如果使用-docker","link":"#对于-x-ui-如果使用-docker","children":[]},{"level":3,"title":"如何使用","slug":"如何使用","link":"#如何使用","children":[{"level":4,"title":"前提：安装好 docker","slug":"前提-安装好-docker","link":"#前提-安装好-docker","children":[]},{"level":4,"title":"运行你的容器","slug":"运行你的容器","link":"#运行你的容器","children":[{"level":5,"title":"使用 vaxilu/x-ui 版本的","slug":"使用-vaxilu-x-ui-版本的","link":"#使用-vaxilu-x-ui-版本的","children":[]},{"level":5,"title":"使用 docker-compose 运行","slug":"使用-docker-compose-运行","link":"#使用-docker-compose-运行","children":[]}]},{"level":4,"title":"如何启用 ssl","slug":"如何启用-ssl","link":"#如何启用-ssl","children":[{"level":5,"title":"步骤如下","slug":"步骤如下","link":"#步骤如下","children":[]}]}]},{"level":3,"title":"3X-UI","slug":"_3x-ui","link":"#_3x-ui","children":[{"level":4,"title":"默认信息","slug":"默认信息","link":"#默认信息","children":[]},{"level":4,"title":"X-UI","slug":"x-ui","link":"#x-ui","children":[]},{"level":4,"title":"安装 & 升级","slug":"安装-升级","link":"#安装-升级","children":[]},{"level":4,"title":"通过Docker安装","slug":"通过docker安装","link":"#通过docker安装","children":[{"level":5,"title":"如果你需要安装ACME.SH用户管理SSL证书的Docker，可以执行一下命令","slug":"如果你需要安装acme-sh用户管理ssl证书的docker-可以执行一下命令","link":"#如果你需要安装acme-sh用户管理ssl证书的docker-可以执行一下命令","children":[]}]},{"level":4,"title":"Install Custom Version","slug":"install-custom-version","link":"#install-custom-version","children":[]}]}]},{"level":2,"title":"零基础保姆级小白节点搭建教学，目前最安全最稳定的搭建方式，通过x-ui面板实现单端口多用户合租","slug":"零基础保姆级小白节点搭建教学-目前最安全最稳定的搭建方式-通过x-ui面板实现单端口多用户合租","link":"#零基础保姆级小白节点搭建教学-目前最安全最稳定的搭建方式-通过x-ui面板实现单端口多用户合租","children":[{"level":3,"title":"VPS购买","slug":"vps购买","link":"#vps购买","children":[]},{"level":3,"title":"域名购买","slug":"域名购买","link":"#域名购买","children":[]},{"level":3,"title":"SSH工具","slug":"ssh工具","link":"#ssh工具","children":[]},{"level":3,"title":"节点搭建","slug":"节点搭建","link":"#节点搭建","children":[]},{"level":3,"title":"寻找适合的伪装站","slug":"寻找适合的伪装站","link":"#寻找适合的伪装站","children":[]},{"level":3,"title":"配置nginx","slug":"配置nginx","link":"#配置nginx","children":[]},{"level":3,"title":"多用户合租","slug":"多用户合租","link":"#多用户合租","children":[]}]},{"level":2,"title":"docker离线镜像","slug":"docker离线镜像","link":"#docker离线镜像","children":[]}],"git":{"createdTime":1731129855000,"updatedTime":1731129855000,"contributors":[{"name":"dkyg666","email":"43946866+dkyg666@users.noreply.github.com","commits":1}]},"readingTime":{"minutes":48.63,"words":14589},"filePathRelative":"other/软路由/OpenWrt/其他.md","localizedDate":"2024年11月9日","excerpt":"\\n<h2>docker导出镜像</h2>\\n<details>\\n  <summary>【查看详情】</summary>\\n<div class=\\"language-text\\" data-ext=\\"text\\" data-title=\\"text\\"><pre class=\\"language-text\\"><code>#!/bin/bash\\n# 设置导出镜像的目录\\nEXPORT_DIR=\\"/mnt/alist/share/images\\"\\n# 确保导出目录存在\\nmkdir -p \\"$EXPORT_DIR\\"\\n# 获取所有的镜像并导出\\nIMAGES=$(docker images xhofe/alist --format \'{{.Repository}}:{{.Tag}}\')\\n# 遍历所有的镜像\\nfor IMAGE in $IMAGES; do\\n    # 分割镜像仓库名和标签\\n    IFS=\\":\\" read -r REPOSITORY TAG &lt;&lt;&lt; \\"$IMAGE\\"\\n    # 将仓库名中的斜杠替换为下划线\\n    SAFE_REPOSITORY=${REPOSITORY//\\\\//_}\\n    # 构造导出文件的名称\\n    EXPORT_FILE=\\"${SAFE_REPOSITORY}_${TAG}.tar\\"\\n    EXPORT_PATH=\\"$EXPORT_DIR/$EXPORT_FILE\\"\\n    # 检查镜像是否存在，如果存在则导出\\n    if docker image inspect \\"${REPOSITORY}:${TAG}\\" &gt;/dev/null 2&gt;&amp;1; then\\n        docker save -o \\"$EXPORT_PATH\\" \\"${REPOSITORY}:${TAG}\\"\\n        echo \\"Exported ${REPOSITORY}:${TAG} to $EXPORT_PATH\\"\\n        # 创建 MD5 文件，只显示 MD5 值和文件名\\n        md5sum \\"$EXPORT_PATH\\" | awk \'{print $1, \\"\'$EXPORT_FILE\'\\"}\' &gt; \\"$EXPORT_PATH.md5\\"\\n        echo \\"MD5 checksum saved to $EXPORT_PATH.md5\\"\\n        # 将镜像文件和 MD5 文件打包成 .tar.gz 压缩文件\\n        tar -czf \\"${EXPORT_PATH}.gz\\" -C \\"$EXPORT_DIR\\" \\"$EXPORT_FILE\\" \\"$EXPORT_FILE.md5\\"\\n        echo \\"Compressed ${EXPORT_FILE} and ${EXPORT_FILE}.md5 into ${EXPORT_PATH}.gz\\"\\n          else\\n        echo \\"Error: ${REPOSITORY}:${TAG} does not exist\\"\\n    fi\\ndone\\necho \\"Export and compression process completed.\\"\\n\\n</code></pre></div> </details>"}');export{Ne as comp,$e as data};
